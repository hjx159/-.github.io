<!-- build time:Sun Mar 10 2024 02:01:02 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="水文 & 摄影" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="水文 & 摄影" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="水文 & 摄影" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="http://example.com/distributed-microservices/ShardingSphere/"><title>ShardingSphere - 分布式微服务 | fantedong = 水文 & 摄影 = 为了能更好地查看图片，你需要一点魔法</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">ShardingSphere</h1><div class="meta"><span class="item" title="创建时间：2024-01-26 22:11:07"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-01-26T22:11:07+08:00">2024-01-26</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>16k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>14 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">fantedong</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926142358927.png"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/distributed-microservices/" itemprop="item" rel="index" title="分类于 分布式微服务"><span itemprop="name">分布式微服务</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/distributed-microservices/ShardingSphere/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="范特东东东"><meta itemprop="description" content="为了能更好地查看图片，你需要一点魔法, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="水文 & 摄影"></span><div class="body md" itemprop="articleBody"><p>Apache ShardingSphere 是一款分布式的数据库生态系统，<strong><font color="red">可以将任意数据库转换为分布式数据库</font></strong>，并通过<font color="red">数据分片、弹性伸缩、加密</font>等能力对原有数据库进行增强。</p><p>ShardingSphere 源码地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9zaGFyZGluZ3NwaGVyZQ==">https://github.com/apache/shardingsphere</span></p><p>ShardingSphere 官方网站：<span class="exturl" data-url="aHR0cHM6Ly9zaGFyZGluZ3NwaGVyZS5hcGFjaGUub3JnLw==">https://shardingsphere.apache.org</span></p><p>文章描述 ShardingSphere 相关概念和知识，如无特别声明，均是 Apache ShardingSphere <code>5.3.2</code> 版本。</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vbmFnZW9mZmVyL3NwcmluZ2Jvb3QtbGFkZGVy">🔥 SpringBoot Ladder</span>：从零到一学习 SpringBoot 各种组件框架实战的项目，让 Demo 变得简单。咱们文章中的 ShardingSphere 示例也在这个项目。</p><h1 id="分库分表背景"><a class="anchor" href="#分库分表背景">#</a> 分库分表背景</h1><p><font color="gree">传统的将数据集中存储至单一节点</font>的解决方案，在<font color="red">性能、可用性和运维成本</font>这三方面已经难于满足海量数据的场景。</p><p>从性能方面来说，由于关系型数据库大多采用 B+ 树类型的索引，在数据量超过阈值的情况下，索引深度的增加也将使得磁盘访问的 IO 次数增加，进而导致查询性能的下降；同时，高并发访问请求也使得集中式数据库成为系统的最大瓶颈。</p><p>从可用性的方面来讲，服务化的无状态性，能够达到较小成本的随意扩容，这必然导致系统的最终压力都落在数据库之上。 而单一的数据节点，或者简单的主从架构，已经越来越难以承担。数据库的可用性，已成为整个系统的关键。</p><p>从运维成本方面考虑，当一个数据库实例中的数据达到阈值以上，对于 DBA 的运维压力就会增大。 数据备份和恢复的时间成本都将随着数据量的大小而愈发不可控。一般来讲，单一数据库实例的数据的阈值在 1TB 之内，是比较合理的范围。</p><p>在传统的关系型数据库无法满足互联网场景需要的情况下，<font color="gree">将数据存储至原生支持分布式的 NoSQL 的尝试越来越多</font>。 <font color="red">但 NoSQL 对 SQL 的不兼容性以及生态圈的不完善</font>，使得它们在与关系型数据库的博弈中始终无法完成致命一击，而关系型数据库的地位却依然不可撼动。</p><p>**<font color="gree">数据分片</font>** 指<font color="red">按照某个维度，将存放在单一数据库中的数据分散地存放至多个数据库或表中</font>，以达到提升性能瓶颈以及可用性的效果。数据分片的有效手段是对关系型数据库进行<font color="red">分库和分表</font>。分库和分表均可以有效的避免由数据量超过可承受阈值而产生的查询瓶颈。 除此之外，分库还能够用于有效的分散对数据库单点的访问量；分表虽然无法缓解数据库压力，但却能够提供尽量将分布式事务转化为本地事务的可能，一旦涉及到跨库的更新操作，分布式事务往往会使问题变得复杂。使用多主多从的分片方式，可以有效的避免数据单点，从而提升数据架构的可用性。</p><p>通过分库和分表进行数据的拆分来使得各个表的数据量保持在阈值以下，以及对流量进行疏导应对高访问量，是应对高并发和海量数据系统的有效手段。数据分片的拆分方式又分为<font color="red">垂直分片和水平分片</font>。</p><h1 id="分库分表介绍"><a class="anchor" href="#分库分表介绍">#</a> 分库分表介绍</h1><h2 id="什么是分库分表"><a class="anchor" href="#什么是分库分表">#</a> 什么是分库分表？</h2><p>分库分表是一种数据库分片技术，用于解决大规模应用中单一数据库容量不足以支持高并发和大数据量的问题。<font color="red">它将一个大型的数据库拆分成多个小型数据库，每个小型数据库称为一个分片。</font>每个分片存储部分数据，从而降低了单个数据库的负担。</p><p><strong><font color="red">简单来说，分库是将原本的单库拆分为多个库，分表是将原来的单表拆分为多个表。</font></strong></p><p>很多情况下，分库分表并不是从系统设计开始就存在的，而是系统运行过程中，出现数据量庞大或者查询性能慢等问题延伸而来。</p><p>如果你在业务功能开发时，已经预知业务数据库量，应提前进行分库或者分表，做好分片规范，避免系统运行时拆分。</p><h3 id="分库"><a class="anchor" href="#分库">#</a> 分库</h3><p>1）<font color="cornflowerblue">垂直分片</font></p><p>比如：电商库 mall_db，业务拆分后就是 user_db、order_db、pay_db...</p><p>按照业务拆分的方式称为垂直分片，又称为纵向拆分，它的核心理念是专库专用。在拆分之前，一个数据库由多个数据表构成，每个表对应着不同的业务。而拆分之后，则是 **<font color="red">按照业务将表进行归类，分布到不同的数据库中</font>**，从而将压力分散至不同的数据库。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926143106698.png" alt="img"></p><p>优点：</p><ul><li>可以针对不同业务场景优化数据库，提高性能。</li><li>提高了数据库的并发能力。</li></ul><p>缺点：</p><ul><li>需要处理<font color="red">分布式事务的问题</font>。</li><li>增加了系统的复杂度。</li></ul><p>2）<font color="cornflowerblue">水平分片</font></p><p>比如：用户库 user_db，分片库后就是 user_db_0、user_db_1、user_db_xx。</p><p>水平分片又称为横向拆分。相对于垂直分片，它不再将数据根据业务逻辑分类，而是 **<font color="red">通过某个字段（或某几个字段），根据某种规则将数据分散至多个库或表中，每个分片仅包含数据的一部分</font>**。 例如：根据主键分片，偶数主键的记录放入 0 库（或表），奇数主键的记录放入 1 库（或表），如下图所示。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926143122066.png" alt="img"></p><p>优点：</p><ul><li>提高了单库的读写性能，降低了单库数据量。</li><li>可以将库存储在不同的物理服务器上，提高了查询效率。</li></ul><p>缺点：</p><ul><li>需要处理<font color="red">跨库查询的问题</font>。</li><li>对分库规则的设计需要谨慎，<font color="red">避免热点数据集中在某个库中</font>。</li></ul><h3 id="分表"><a class="anchor" href="#分表">#</a> 分表</h3><p>1）<font color="cornflowerblue">垂直分片</font></p><p>比如：订单表 order_table，拆分后就是 order_table 以及 order_ext_table。</p><p>同分库的概念，只不过将数据库维度降低为数据库表维度。</p><p>优点：</p><ul><li>拆分后每个表的数据量变小，查询时涉及的磁盘 I/O 次数相对减少，提高了查询效率。</li><li>每个小表的并发写入操作相对较少，减少了数据库锁的竞争，提高了并发能力。</li></ul><p>缺点：</p><ul><li><font color="red">需要在应用层面处理<strong>跨表查询的逻辑</strong>，增加了开发的复杂性</font>。</li><li>如果一个事务涉及多个小表，可能<font color="red">需要在应用层面进行<strong>事务管理</strong>，增加了代码的复杂性</font>。</li><li>需要额外的措施来<font color="red">保证拆分后的小表之间的<strong>数据一致性</strong></font>。</li></ul><p>2）<font color="cornflowerblue">水平分片</font></p><p>比如：订单表 order_table，拆分后就是 order_table_0、 order_table_1、order_table_xxx。</p><p>同分库的概念，只不过将数据库维度降低为数据库表维度。</p><p>优点：</p><ul><li>可以根据数据量的增长动态地增加分表，从而扩展数据库的存储能力。</li><li>每个小表的数据量减少，可以提高查询速度，尤其是在频繁查询的场景下。</li><li>拆分后，每个小表的并发写入操作相对减少，降低了数据库锁的竞争，提高了并发性能。</li></ul><p>缺点：</p><ul><li>对业务存在一定限制，<font color="red">如果没有按照分片键查询，会造成读扩散问题</font>。</li><li>对分表规则的设计需要谨慎，<font color="red">避免热点数据集中在某个表中</font>。</li></ul><h2 id="分库分表场景"><a class="anchor" href="#分库分表场景">#</a> 分库分表场景</h2><h3 id="分表场景"><a class="anchor" href="#分表场景">#</a> 分表场景</h3><p><font color="red">数据量过大</font>或者<font color="red">数据库表对应的磁盘文件过大</font>。</p><p>Q：多少数据量进行分表？</p><p>A：单表 1000w 是否要分表？回答不够标准。假设一个表里 15 个字段，没有特别大的值（不包含 text 或其它超长度的列）数据量超过 5000 万了，依然很丝滑，因为走索引。</p><p>真正需要考虑的是：业务的增长量以及历史数量。</p><p>Q：物理文件过大，会有什么问题？</p><p>A：会影响公司对数据库表的一个备份。数据库表文件过大，也间接证明表数据过大，增加或删除字段导致锁表的时间过长。</p><h3 id="分库场景"><a class="anchor" href="#分库场景">#</a> 分库场景</h3><p><font color="red">当数据库的连接数量不够客户端使用时</font>，可以考虑分库或读写分离。</p><p>如果说当数据库的 QPS 越来越高以及数据量越来越大的时候，就需要考虑分库分表。</p><p>Q：为什么说连接不够用？</p><p>A：假设 MySQL Server 能支持 4000 个数据库连接。我们有 10 个服务，40 个节点，一个节点呢数据库连接池最多 10 个。这样就把一个 MySQL Server 的连接数压榨干净了。</p><p>当 MySQL 连接不够用时，可能会报错 &quot;Too many connections&quot; 或者类似的错误。这是因为 MySQL 服务器同时可以处理的连接数量是有限制的，当连接数达到这个限制时，服务器就会拒绝新的连接请求，并返回这个错误消息。</p><h3 id="分库分表场景-2"><a class="anchor" href="#分库分表场景-2">#</a> 分库分表场景</h3><ul><li><font color="red">高并发写入</font>场景：当应用面临高并发的写入请求时，单一数据库可能无法满足写入压力，此时可以将数据按照一定规则拆分到多个数据库中，每个数据库处理部分数据的写入请求，从而提高写入性能。</li><li><font color="red">数据量巨大</font>场景：随着数据量的不断增加，单一数据库的存储和查询性能可能逐渐下降。此时，可以将数据按照一定的规则拆分到多个表中，每个表存储部分数据，从而分散数据的存储压力，提高查询性能。</li></ul><h1 id="shardingsphere-介绍"><a class="anchor" href="#shardingsphere-介绍">#</a> ShardingSphere 介绍</h1><p>Apache ShardingSphere 是一款分布式的数据库生态系统，<strong><font color="red">可以将任意数据库转换为分布式数据库</font></strong>，并通过<font color="red">数据分片、弹性伸缩、加密</font>等能力对原有数据库进行增强。</p><p>Apache ShardingSphere 设计哲学为 Database Plus，旨在构建异构数据库上层的标准和生态。它关注如何充分合理地利用数据库的计算和存储能力，而并非实现一个全新的数据库。它站在数据库的上层视角，关注它们之间的协作多于数据库自身。</p><p>ShardingSphere 有两个产品在企业中广泛使用，分别是 <code>ShardingSphere-JDBC</code> 以及 <code>ShardingSphere-Proxy</code> 。</p><h2 id="shardingsphere-jdbc"><a class="anchor" href="#shardingsphere-jdbc">#</a> ShardingSphere-JDBC</h2><p><code>ShardingSphere-JDBC</code> 定位为轻量级 Java 框架，在 Java 的 JDBC 层提供的额外服务。<font color="red">它使用客户端直连数据库，以 Jar 包形式提供服务，无需额外部署和依赖，可理解为<strong>增强版的 JDBC 驱动</strong>，完全兼容 JDBC 和各种 ORM 框架</font>。</p><ul><li>适用于任何基于 JDBC 的 ORM 框架，如：JPA, Hibernate, Mybatis, Spring JDBC Template 或直接使用 JDBC；</li><li>支持任何第三方的数据库连接池，如：DBCP, C3P0, BoneCP, HikariCP 等；</li><li>支持任意实现 JDBC 规范的数据库，目前支持 MySQL，PostgreSQL，Oracle，SQLServer 以及任何可使用 JDBC 访问的数据库。</li></ul><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926142255390.png" alt="img"></p><h2 id="shardingsphere-proxy"><a class="anchor" href="#shardingsphere-proxy">#</a> ShardingSphere-Proxy</h2><p><code>ShardingSphere-Proxy</code> 定位为<font color="red"><strong>透明化的数据库代理端</strong>，通过实现数据库二进制协议，对异构语言提供支持</font>。目前提供 MySQL 和 PostgreSQL 协议，透明化数据库操作，对 DBA 更加友好。</p><ul><li>向应用程序完全透明，可直接当做 MySQL/PostgreSQL 使用；</li><li>兼容 MariaDB 等基于 MySQL 协议的数据库，以及 openGauss 等基于 PostgreSQL 协议的数据库；</li><li>适用于任何兼容 MySQL/PostgreSQL 协议的的客户端，如：MySQL Command Client, MySQL Workbench, Navicat 等。</li></ul><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926142321036.png" alt="img"></p><h2 id="混合部署"><a class="anchor" href="#混合部署">#</a> 混合部署</h2><p><code>ShardingSphere-JDBC</code> 采用无中心化架构，与应用程序共享资源，适用于 Java 开发的高性能的轻量级 OLTP 应用； <code>ShardingSphere-Proxy</code> 提供静态入口以及异构语言的支持，独立于应用程序部署，适用于 OLAP 应用以及对分片数据库进行管理和运维的场景。</p><p><code>Apache ShardingSphere</code> 是多接入端共同组成的生态圈。<font color="red">通过混合使用 <code>ShardingSphere-JDBC</code> 和 <code>ShardingSphere-Proxy</code> ，并采用同一注册中心统一配置分片策略，能够灵活的搭建适用于各种场景的应用系统，使得架构师更加自由地调整适合于当前业务的最佳系统架构</font>。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926142358927.png" alt="img"></p><h2 id="产品功能"><a class="anchor" href="#产品功能">#</a> 产品功能</h2><p>这里给大家列一些经常使用且入门门槛较低的功能，更多的功能大家可以去 ShardingSphere 官网发掘。</p><table><thead><tr><th style="text-align:left">特性</th><th style="text-align:left">定义</th></tr></thead><tbody><tr><td style="text-align:left"><strong>数据分片</strong></td><td style="text-align:left">数据分片，是应对海量数据存储与计算的有效手段。ShardingSphere 基于底层数据库提供分布式数据库解决方案，可以水平扩展计算和存储。</td></tr><tr><td style="text-align:left"><strong>读写分离</strong></td><td style="text-align:left">读写分离，是应对高压力业务访问的手段。基于对 SQL 语义理解及对底层数据库拓扑感知能力，ShardingSphere 提供灵活的<font color="red">读写流量拆分</font>和<font color="red">读流量负载均衡</font>。</td></tr><tr><td style="text-align:left"><strong>数据加密</strong></td><td style="text-align:left">数据加密，是保证数据安全的基本手段。ShardingSphere 提供完整、透明、安全、低成本的数据加密解决方案。</td></tr><tr><td style="text-align:left"><strong>影子库</strong></td><td style="text-align:left">在全链路压测场景下，ShardingSphere <font color="red">支持不同工作负载下的数据隔离，避免测试数据污染生产环境</font>。</td></tr><tr><td style="text-align:left">......</td><td style="text-align:left">......</td></tr></tbody></table><h2 id="设计哲学"><a class="anchor" href="#设计哲学">#</a> 设计哲学</h2><p>ShardingSphere 采用 Database Plus 设计哲学，该理念<font color="red">致力于构建数据库上层的标准和生态</font>，在生态中补充数据库所缺失的能力。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/design_cn.png" alt="img"></p><h1 id="数据分片核心概念"><a class="anchor" href="#数据分片核心概念">#</a> 数据分片核心概念</h1><h2 id="表"><a class="anchor" href="#表">#</a> 表</h2><p>表是透明化数据分片的关键概念。 Apache ShardingSphere 通过<font color="red">提供多样化的表类型，适配不同场景下的数据分片需求</font>。</p><h3 id="逻辑表"><a class="anchor" href="#逻辑表">#</a> 逻辑表</h3><p><strong><font color="red">相同结构的水平拆分数据库（表）的逻辑名称</font></strong>，是 SQL 中表的逻辑标识。 例：订单数据根据主键尾数拆分为 10 张表，分别是 <code>t_order_0</code> 到 <code>t_order_9</code> ，他们的逻辑表名为 <code>t_order</code> 。</p><h3 id="真实表"><a class="anchor" href="#真实表">#</a> 真实表</h3><p><strong><font color="red">在水平拆分的数据库中真实存在的物理表</font></strong>。即上个示例中的 <code>t_order_0</code> 到 <code>t_order_9</code> 。</p><h3 id="绑定表"><a class="anchor" href="#绑定表">#</a> 绑定表</h3><p><strong><font color="red">分片规则一致的一组分片表</font></strong>。使用绑定表进行多表关联查询时，必须使用<font color="red">分片键</font>进行关联，否则会出现笛卡尔积关联或跨库关联，从而影响查询效率。</p><p>例如： <code>t_order</code> 表和 <code>t_order_item</code> 表，均按照 <code>order_id</code> 分片，并且使用 <code>order_id</code> 进行关联，则此两张表互为绑定表关系。绑定表之间的多表关联查询不会出现笛卡尔积关联，关联查询效率将大大提升。举例说明，如果 SQL 为：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order o <span class="token keyword">JOIN</span> t_order_item i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在不配置绑定表关系时，假设分片键 order_id 将数值 10 路由至第 0 片，将数值 11 路由至第 1 片，那么路由后的 SQL 应该为 4 条，它们呈现为笛卡尔积：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_0 o <span class="token keyword">JOIN</span> t_order_item_0 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_0 o <span class="token keyword">JOIN</span> t_order_item_1 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_1 o <span class="token keyword">JOIN</span> t_order_item_0 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_1 o <span class="token keyword">JOIN</span> t_order_item_1 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在配置绑定表关系，并且使用 <code>order_id</code> 进行关联后，路由的 SQL 应该为 2 条：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_0 o <span class="token keyword">JOIN</span> t_order_item_0 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_order_1 o <span class="token keyword">JOIN</span> t_order_item_1 i <span class="token keyword">ON</span> o<span class="token punctuation">.</span>order_id<span class="token operator">=</span>i<span class="token punctuation">.</span>order_id <span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>order_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="广播表"><a class="anchor" href="#广播表">#</a> 广播表</h3><p><strong><font color="red">所有的数据源中都存在的表，表结构及其数据在每个数据库中均完全一致</font></strong>。<font color="red">适用于数据量不大且需要与海量数据的表进行关联查询的场景，例如：字典表。</font></p><h3 id="单表"><a class="anchor" href="#单表">#</a> 单表</h3><p><strong><font color="red">所有的分片数据源中仅唯一存在的表</font></strong>。<font color="red">适用于数据量不大且无需分片的表</font>。</p><p>注意：<font color="red">符合以下条件的单表会被自动加载</font>：</p><ul><li>数据加密、数据脱敏等规则中显示配置的单表</li><li>用户通过 ShardingSphere 执行 DDL 语句创建的单表</li></ul><p>其余不符合上述条件的单表，ShardingSphere 不会自动加载，用户可根据需要配置单表规则进行管理。</p><h2 id="数据节点"><a class="anchor" href="#数据节点">#</a> 数据节点</h2><p><strong><font color="red">是数据分片的最小单元，由数据源名称和真实表组成</font></strong>。例：ds_0.t_order_0。逻辑表与真实表的映射关系，可分为均匀分布和自定义分布两种形式。</p><h3 id="均匀分布"><a class="anchor" href="#均匀分布">#</a> 均匀分布</h3><p>指<font color="red">数据表在每个数据源内呈现均匀分布的态势</font>，例如：</p><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>db0</pre></td></tr><tr><td data-num="2"></td><td><pre>  ├── t_order0</pre></td></tr><tr><td data-num="3"></td><td><pre>  └── t_order1</pre></td></tr><tr><td data-num="4"></td><td><pre>db1</pre></td></tr><tr><td data-num="5"></td><td><pre>  ├── t_order0</pre></td></tr><tr><td data-num="6"></td><td><pre>  └── t_order1</pre></td></tr></table></figure><p>数据节点的配置如下：</p><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>db0.t_order0, db0.t_order1, db1.t_order0, db1.t_order1</pre></td></tr></table></figure><h3 id="自定义分布"><a class="anchor" href="#自定义分布">#</a> 自定义分布</h3><p>指<font color="red">数据表呈现有特定规则的分布</font>， 例如：</p><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>db0</pre></td></tr><tr><td data-num="2"></td><td><pre>  ├── t_order0</pre></td></tr><tr><td data-num="3"></td><td><pre>  └── t_order1</pre></td></tr><tr><td data-num="4"></td><td><pre>db1</pre></td></tr><tr><td data-num="5"></td><td><pre>  ├── t_order2</pre></td></tr><tr><td data-num="6"></td><td><pre>  ├── t_order3</pre></td></tr><tr><td data-num="7"></td><td><pre>  └── t_order4</pre></td></tr></table></figure><p>数据节点的配置如下：</p><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>db0.t_order0, db0.t_order1, db1.t_order2, db1.t_order3, db1.t_order4</pre></td></tr></table></figure><h2 id="分片"><a class="anchor" href="#分片">#</a> 分片</h2><h3 id="分片键"><a class="anchor" href="#分片键">#</a> 分片键</h3><p><strong><font color="red">用于将数据库（表）<u>水平拆分</u>的数据库字段</font></strong>。例：将订单表中的订单主键的尾数取模分片，则订单主键为分片字段。 SQL 中如果无分片字段，将执行全路由，性能较差。 除了对单分片字段的支持，Apache ShardingSphere 也支持根据多个字段进行分片。</p><h3 id="分片算法"><a class="anchor" href="#分片算法">#</a> 分片算法</h3><p>用于将数据分片的算法，支持 <code>=</code> 、 <code>&gt;=</code> 、 <code>&lt;=</code> 、 <code>&gt;</code> 、 <code>&lt;</code> 、 <code>BETWEEN</code> 和 <code>IN</code> 进行分片。分片算法可由开发者自行实现，也可使用 Apache ShardingSphere <font color="red">内置的分片算法语法糖</font>，灵活度非常高。</p><h3 id="自动化分片算法"><a class="anchor" href="#自动化分片算法">#</a> 自动化分片算法</h3><p>分片算法语法糖，用于便捷的托管所有数据节点，<font color="red">使用者无需关注真实表的物理分布</font>。包括<font color="red">取模、哈希、范围、时间</font>等常用分片算法的实现。</p><h3 id="自定义分片算法"><a class="anchor" href="#自定义分片算法">#</a> 自定义分片算法</h3><p>提供接口让应用开发者自行实现与业务实现紧密相关的分片算法，并允许使用者自行管理真实表的物理分布。自定义分片算法又分为：</p><ul><li><font color="red">标准分片算法</font>：用于处理使用单一键作为分片键的 <code>=</code> 、 <code>IN</code> 、 <code>BETWEEN AND</code> 、 <code>&gt;</code> 、 <code>&lt;</code> 、 <code>&gt;=</code> 、 <code>&lt;=</code> 进行分片的场景。</li><li><font color="red">复合分片算法</font>：用于处理使用多键作为分片键进行分片的场景，包含多个分片键的逻辑较复杂，需要应用开发者自行处理其中的复杂度。</li><li><font color="red">Hint 分片算法</font>：用于处理使用 <code>Hint</code> 行分片的场景。</li></ul><h3 id="分片策略"><a class="anchor" href="#分片策略">#</a> 分片策略</h3><p>包含分片键和分片算法，由于分片算法的独立性，将其独立抽离。真正可用于分片操作的是<font color="red">分片键 + 分片算法</font>，也就是分片策略。</p><h3 id="强制分片路由"><a class="anchor" href="#强制分片路由">#</a> 强制分片路由</h3><p>对于<font color="red">分片字段并非由 SQL 而是其他外置条件决定的场景</font>，可使用 <code>SQL Hint</code> 注入分片值。 例：按照员工登录主键分库，而数据库中并无此字段。 SQL Hint 支持通过 Java API 和 SQL 注释两种方式使用。 详情请参见强制分片路由。</p><h2 id="行表达式"><a class="anchor" href="#行表达式">#</a> 行表达式</h2><p>行表达式是 **<font color="red">为了解决配置的简化与一体化这两个主要问题</font>**。在繁琐的数据分片规则配置中，随着数据节点的增多，大量的重复配置使得配置本身不易被维护。通过行表达式可以有效地<font color="red">简化数据节点的配置工作量</font>。</p><p>对于常见的分片算法，使用 Java 代码实现并不有助于配置的统一管理。 <font color="red">通过<u>行表达式</u>书写分片算法，可以有效地将规则配置一同存放，更加易于浏览与存储</font>。</p><p><font color="red">行表达式作为字符串由两部分组成，分别是以字符串开头的对应 SPI 实现的 Type Name 部分和表达式部分</font>。 以 <code>&lt;GROOVY&gt;t_order_$&#123;1..3&#125;</code> 为例，字符串 <code>&lt;GROOVY&gt;</code> 部分的子字符串 <code>GROOVY</code> 为此行表达式使用的对应 SPI 实现的 Type Name，其被 <code>&lt;&gt;</code> 符号包裹来识别。而字符串 <code>t_order_$&#123;1..3&#125;</code> 为此行表达式的表达式部分。当行表达式不指定 Type Name 时，例如 <code>t_order_$&#123;1..3&#125;</code> ，<font color="red">行表示式默认将使用 <code>InlineExpressionParser</code> SPI 的 <code>GROOVY</code> 实现来解析表达式</font>。</p><p>以下部分介绍 <code>GROOVY</code> 实现的语法规则。</p><p>行表达式的使用非常直观，只需要在配置中使用 <code>$&#123; expression &#125;</code> 或 <code>$-&gt;&#123; expression &#125;</code> 标识行表达式即可。 <font color="red">目前支持数据节点和分片算法这两个部分的配置</font>。行表达式的内容使用的是 <font color="red">Groovy 的语法</font>，Groovy 能够支持的所有操作，行表达式均能够支持。 例如：</p><p><code>$&#123;begin..end&#125;</code> 表示范围区间 <code>$&#123;[unit1, unit2, unit_x]&#125;</code> 表示枚举值。</p><p>行表达式中如果出现连续多个 <code>$&#123; expression &#125;</code> 或 <code>$-&gt;&#123; expression &#125;</code> 表达式，整个表达式最终的结果将会根据每个子表达式的结果进行<font color="red">笛卡尔组合</font>。</p><p>例如，以下行表达式：</p><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>$&#123;['online', 'offline']&#125;_table$&#123;1..3&#125;</pre></td></tr></table></figure><p>最终会解析为：</p><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>online_table1, online_table2, online_table3, offline_table1, offline_table2, offline_table3</pre></td></tr></table></figure><h2 id="分布式主键"><a class="anchor" href="#分布式主键">#</a> 分布式主键</h2><p>传统数据库软件开发中，主键自动生成技术是基本需求。而各个数据库对于该需求也提供了相应的支持，比如 MySQL 的自增键，Oracle 的自增序列等。 <font color="red">数据分片后，不同数据节点生成全局唯一主键是非常棘手的问题。同一个逻辑表内的不同实际表之间的自增键由于无法互相感知而产生重复主键。</font>虽然可通过约束自增主键初始值和步长的方式避免碰撞，但需引入额外的运维规则，使解决方案缺乏完整性和可扩展性。</p><p>目前有许多第三方解决方案可以完美解决这个问题，如 UUID 等依靠特定算法自生成不重复键，或者通过引入主键生成服务等。为了方便用户使用、满足不同用户不同使用场景的需求， <font color="red">Apache ShardingSphere 不仅提供了<strong>内置的分布式主键生成器</strong>，例如 <code>UUID</code> 、 <code>SNOWFLAKE</code> ，还抽离出<strong>分布式主键生成器的接口</strong>，方便用户自行实现自定义的自增主键生成器</font>。</p><h1 id="动手实现数据分表"><a class="anchor" href="#动手实现数据分表">#</a> 动手实现数据分表</h1><p>下文代码示例地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vbmFnZW9mZmVyL3NwcmluZ2Jvb3QtbGFkZGVyL3RyZWUvbWFpbi9zaGFyZGluZ3NwaGVyZS01eC9zaGFyZGluZ3NwaGVyZS01eC1zaGFyZGluZw==">SpringBoot-Ladder ShardingSphere 5.x 分库分表示例程序 </span>。</p><h2 id="准备数据库表"><a class="anchor" href="#准备数据库表">#</a> 准备数据库 &amp; 表</h2><p>MySQL 创建数据库 <code>user_0</code> ，创建后，执行以下数据库表 <code>t_user_0</code> 、 <code>t_user_1</code> 的创建语句。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t_user_0<span class="token punctuation">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'ID'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>real_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'真实姓名'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>region<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'国家/地区'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>id_type<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'证件类型'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>id_card<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'证件号'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>phone<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>telephone<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'固定电话'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>mail<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>user_type<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'旅客类型'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>verify_status<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'审核状态'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>post_code<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮编'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'地址'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>deletion_time<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'注销时间戳'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>del_flag<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'删除标识'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1695720264773</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'用户表'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t_user_1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'ID'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>real_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'真实姓名'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>region<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'国家/地区'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>id_type<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'证件类型'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>id_card<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'证件号'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>phone<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>telephone<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'固定电话'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>mail<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>user_type<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'旅客类型'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>verify_status<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'审核状态'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>post_code<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮编'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'地址'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>deletion_time<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'注销时间戳'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>del_flag<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'删除标识'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1695720264420</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'用户表'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="开发用户持久层代码"><a class="anchor" href="#开发用户持久层代码">#</a> 开发用户持久层代码</h2><p>引入 MyBatisPlus 以及和 MySQL 相关依赖，开发普通的用户持久层代码逻辑。</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;mybatis-plus.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>创建用户持久层实体。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">FieldFill</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableField</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableName</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Builder</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="12"></td><td><pre> * 用户信息实体</pre></td></tr><tr><td data-num="13"></td><td><pre> *</pre></td></tr><tr><td data-num="14"></td><td><pre> * @公众号：马丁玩编程，回复：加群，添加马哥微信（备注：ladder）获取更多项目资料</pre></td></tr><tr><td data-num="15"></td><td><pre> */</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token annotation punctuation">@Data</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token annotation punctuation">@NoArgsConstructor</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token annotation punctuation">@AllArgsConstructor</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token annotation punctuation">@Builder</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"t_user"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDO</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="24"></td><td><pre>     * id</pre></td></tr><tr><td data-num="25"></td><td><pre>     */</pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="29"></td><td><pre>     * 用户名</pre></td></tr><tr><td data-num="30"></td><td><pre>     */</pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="34"></td><td><pre>     * 密码</pre></td></tr><tr><td data-num="35"></td><td><pre>     */</pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="39"></td><td><pre>     * 真实姓名</pre></td></tr><tr><td data-num="40"></td><td><pre>     */</pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> realName<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="44"></td><td><pre>     * 国家 / 地区</pre></td></tr><tr><td data-num="45"></td><td><pre>     */</pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> region<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="49"></td><td><pre>     * 证件类型</pre></td></tr><tr><td data-num="50"></td><td><pre>     */</pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> idType<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="54"></td><td><pre>     * 证件号</pre></td></tr><tr><td data-num="55"></td><td><pre>     */</pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> idCard<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="59"></td><td><pre>     * 手机号</pre></td></tr><tr><td data-num="60"></td><td><pre>     */</pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="64"></td><td><pre>     * 固定电话</pre></td></tr><tr><td data-num="65"></td><td><pre>     */</pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> telephone<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="69"></td><td><pre>     * 邮箱</pre></td></tr><tr><td data-num="70"></td><td><pre>     */</pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> mail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="74"></td><td><pre>     * 旅客类型</pre></td></tr><tr><td data-num="75"></td><td><pre>     */</pre></td></tr><tr><td data-num="76"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> userType<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre></pre></td></tr><tr><td data-num="78"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="79"></td><td><pre>     * 审核状态</pre></td></tr><tr><td data-num="80"></td><td><pre>     */</pre></td></tr><tr><td data-num="81"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> verifyStatus<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="84"></td><td><pre>     * 邮编</pre></td></tr><tr><td data-num="85"></td><td><pre>     */</pre></td></tr><tr><td data-num="86"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> postCode<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre></pre></td></tr><tr><td data-num="88"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="89"></td><td><pre>     * 地址</pre></td></tr><tr><td data-num="90"></td><td><pre>     */</pre></td></tr><tr><td data-num="91"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="94"></td><td><pre>     * 注销时间戳</pre></td></tr><tr><td data-num="95"></td><td><pre>     */</pre></td></tr><tr><td data-num="96"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Long</span> deletionTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="99"></td><td><pre>     * 创建时间</pre></td></tr><tr><td data-num="100"></td><td><pre>     */</pre></td></tr><tr><td data-num="101"></td><td><pre>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span><span class="token constant">INSERT</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre></pre></td></tr><tr><td data-num="104"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="105"></td><td><pre>     * 修改时间</pre></td></tr><tr><td data-num="106"></td><td><pre>     */</pre></td></tr><tr><td data-num="107"></td><td><pre>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span><span class="token constant">INSERT_UPDATE</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="108"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre></pre></td></tr><tr><td data-num="110"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="111"></td><td><pre>     * 删除标志</pre></td></tr><tr><td data-num="112"></td><td><pre>     */</pre></td></tr><tr><td data-num="113"></td><td><pre>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span><span class="token constant">INSERT</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="114"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> delFlag<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>创建用户实体对应的 MyBatis Mapper 持久层接口。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BaseMapper</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>nageoffer<span class="token punctuation">.</span>springbootladder<span class="token punctuation">.</span>shardingspherecore<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">UserDO</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="5"></td><td><pre> * 用户信息持久层</pre></td></tr><tr><td data-num="6"></td><td><pre> *</pre></td></tr><tr><td data-num="7"></td><td><pre> * @公众号：马丁玩编程，回复：加群，添加马哥微信（备注：ladder）获取更多项目资料</pre></td></tr><tr><td data-num="8"></td><td><pre> */</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserDO</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>创建用户接口，为了避免重复代码，这里直接继承 MyBatisPlus 的 IService 通用接口，实现增删改查。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IService</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>nageoffer<span class="token punctuation">.</span>springbootladder<span class="token punctuation">.</span>shardingspherecore<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">UserDO</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="5"></td><td><pre> * 用户信息接口层</pre></td></tr><tr><td data-num="6"></td><td><pre> *</pre></td></tr><tr><td data-num="7"></td><td><pre> * @公众号：马丁玩编程，回复：加群，添加马哥微信（备注：ladder）获取更多项目资料</pre></td></tr><tr><td data-num="8"></td><td><pre> */</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserDO</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">ServiceImpl</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>nageoffer<span class="token punctuation">.</span>springbootladder<span class="token punctuation">.</span>shardingspherecore<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">UserDO</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>nageoffer<span class="token punctuation">.</span>springbootladder<span class="token punctuation">.</span>shardingspherecore<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">UserMapper</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="18"></td><td><pre> * 用户信息接口实现层</pre></td></tr><tr><td data-num="19"></td><td><pre> *</pre></td></tr><tr><td data-num="20"></td><td><pre> * @公众号：马丁玩编程，回复：加群，添加马哥微信（备注：ladder）获取更多项目资料</pre></td></tr><tr><td data-num="21"></td><td><pre> */</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserMapper</span><span class="token punctuation">,</span> <span class="token class-name">UserDO</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="引入-shardingsphere-jdbc"><a class="anchor" href="#引入-shardingsphere-jdbc">#</a> 引入 ShardingSphere-JDBC</h2><p>引入 ShardingSphere-JDBC 的 Maven Jar 包，这里使用 5.3.2。</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>shardingsphere-jdbc-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>SpringBoot 和 ShardingSphere 配置文件的关联方式详情见下图。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926175048282.png" alt="img"></p><p>5.x.x 版本后，ShardingSphere-JDBC 的配置文件配置方式有了大的变化，从之前和 Spring 耦合变更为完全解耦，大家需要明确。</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6060</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># 指定 ShardingSphere 自定义驱动类</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> org.apache.shardingsphere.driver.ShardingSphereDriver</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment"># 指定 ShardingSphere 自定义配置文件路径地址</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>shardingsphere<span class="token punctuation">:</span>classpath<span class="token punctuation">:</span>shardingsphere<span class="token punctuation">-</span>config.yaml</pre></td></tr></table></figure><p>创建 ShardingSphere 自定义分片配置文件 <code>shardingsphere-config.yaml</code> 。</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 数据源集合</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">dataSources</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment"># 逻辑数据源名称</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">ds_0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># 数据源类型</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">dataSourceClassName</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># 数据库驱动</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment"># 数据库连接</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">jdbcUrl</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/user_0<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;rewriteBatchedStatements=true&amp;allowMultiQueries=true&amp;serverTimezone=Asia/Shanghai</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment"># 用户名，如果本地数据库与这个不一致，需要修改</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">username</span><span class="token punctuation">:</span> root</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># 密码，如果本地数据库与这个不一致，需要修改</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">password</span><span class="token punctuation">:</span> root</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># ShardingSphere 规则配置，包含：数据分片、数据加密、读写分离等</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token key atrule">rules</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">-</span> <span class="token tag">!SHARDING</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment"># 需要数据分片的表集合</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token key atrule">tables</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token comment"># 逻辑表名</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token key atrule">t_user</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token comment"># 真实存在数据库的物理表集合</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_0.t_user_$<span class="token punctuation">&#123;</span>0..1<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token comment"># 分表策略</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>          <span class="token comment"># 单分片键分表</span></pre></td></tr><tr><td data-num="28"></td><td><pre>          <span class="token key atrule">standard</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token comment"># 自定义分片字段</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> id</pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token comment"># 自定义分片算法名称，对应 &#123;rules [0].shardingAlgorithms.user_table_hash_mod&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> user_table_hash_mod</pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment"># 数据分片算法定义集合</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token key atrule">shardingAlgorithms</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token comment"># 自定义分片算法名称</span></pre></td></tr><tr><td data-num="36"></td><td><pre>      <span class="token key atrule">user_table_hash_mod</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token comment"># 分片方式，HASH_MODE，按照 HASH 的方式对分片键进行操作，获取真实的物理表索引</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token key atrule">type</span><span class="token punctuation">:</span> HASH_MOD</pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token key atrule">props</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>          <span class="token comment"># 物理表分片数量</span></pre></td></tr><tr><td data-num="41"></td><td><pre>          <span class="token key atrule">sharding-count</span><span class="token punctuation">:</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token key atrule">props</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token comment"># 是否打印逻辑 SQL 和真实 SQL，开发测试环境建议开放，生产环境建议关闭</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token key atrule">sql-show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr></table></figure><h2 id="测试分表效果"><a class="anchor" href="#测试分表效果">#</a> 测试分表效果</h2><p>项目中引入了 Swagger3，通过界面 UI 发送一条消息测试效果。访问 <code>http://127.0.0.1:6060/swagger-ui/index.html</code> ，调用定义的新增数据和查询数据方法。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926223335777.png" alt="img"></p><p>点击 Execute 执行方法调用。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926223434188.png" alt="img"></p><p>通过新增用户方法调用得知，返回数据为成功。并在返回信息中，添加了用户 ID，可以根据该 ID 去查询数据库记录。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20230926223516210.png" alt="img"></p><p>通过数据库日志得知，该数据被新增到 <code>t_user_1</code> 表中。</p><figure class="highlight txt"><figcaption data-lang="txt"></figcaption><table><tr><td data-num="1"></td><td><pre>2023-09-26T22:34:46.413+08:00  INFO 78131 --- [nio-6060-exec-1] ShardingSphere-SQL                       : Actual SQL: ds_0 ::: INSERT INTO t_user_1  ( id,</pre></td></tr><tr><td data-num="2"></td><td><pre>username,</pre></td></tr><tr><td data-num="3"></td><td><pre>password,</pre></td></tr><tr><td data-num="4"></td><td><pre>id_type,</pre></td></tr><tr><td data-num="5"></td><td><pre>id_card,</pre></td></tr><tr><td data-num="6"></td><td><pre>phone,</pre></td></tr><tr><td data-num="7"></td><td><pre>address,</pre></td></tr><tr><td data-num="8"></td><td><pre>create_time,</pre></td></tr><tr><td data-num="9"></td><td><pre>update_time,</pre></td></tr><tr><td data-num="10"></td><td><pre>del_flag )  VALUES  (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ::: [1695738886407, 公众号@马丁玩编程, mqEc1mududm63JuxHmpm6jSUHy8xRRsL, 0, 110101202309305156, 15601166692, 杭州市阿里巴巴园区, 2023-09-26 22:34:46.407, 2023-09-26 22:34:46.407, 0]</pre></td></tr></table></figure><p>拿到刚才的方法返回 ID，根据 ID 查询这条数据的信息。</p><p><img data-src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20230926223811260.png" alt="img"></p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-03-02 11:34:13" itemprop="dateModified" datetime="2024-03-02T11:34:13+08:00">2024-03-02</time> </span><span id="distributed-microservices/ShardingSphere/" class="item leancloud_visitors" data-flag-title="ShardingSphere" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>范特东东东 <i class="ic i-at"><em>@</em></i>水文 & 摄影</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/distributed-microservices/ShardingSphere/" title="ShardingSphere">http://example.com/distributed-microservices/ShardingSphere/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/mq/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;hjx159&#x2F;picture-bed&#x2F;main&#x2F;img&#x2F;p68921.png" title="消息队列"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 消息队列</span><h3>消息队列</h3></a></div><div class="item right"><a href="/photography/%E7%B4%AB%E7%AB%B9%E9%99%A2%E5%85%AC%E5%9B%AD/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;pic.imgdb.cn&#x2F;item&#x2F;65e5f89e9f345e8d036fa68a.jpg" title="紫竹院公园"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 摄影</span><h3>紫竹院公园</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">分库分表背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">分库分表介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-number">2.1.</span> <span class="toc-text">什么是分库分表？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93"><span class="toc-number">2.1.1.</span> <span class="toc-text">分库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%A1%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">分表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.2.</span> <span class="toc-text">分库分表场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%A1%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.2.1.</span> <span class="toc-text">分表场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%9C%BA%E6%99%AF"><span class="toc-number">2.2.2.</span> <span class="toc-text">分库场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-number">2.2.3.</span> <span class="toc-text">分库分表场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#shardingsphere-%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text">ShardingSphere 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#shardingsphere-jdbc"><span class="toc-number">3.1.</span> <span class="toc-text">ShardingSphere-JDBC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shardingsphere-proxy"><span class="toc-number">3.2.</span> <span class="toc-text">ShardingSphere-Proxy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E9%83%A8%E7%BD%B2"><span class="toc-number">3.3.</span> <span class="toc-text">混合部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E5%8A%9F%E8%83%BD"><span class="toc-number">3.4.</span> <span class="toc-text">产品功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6"><span class="toc-number">3.5.</span> <span class="toc-text">设计哲学</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">4.</span> <span class="toc-text">数据分片核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8"><span class="toc-number">4.1.</span> <span class="toc-text">表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%A1%A8"><span class="toc-number">4.1.1.</span> <span class="toc-text">逻辑表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9E%E8%A1%A8"><span class="toc-number">4.1.2.</span> <span class="toc-text">真实表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E8%A1%A8"><span class="toc-number">4.1.3.</span> <span class="toc-text">绑定表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%E8%A1%A8"><span class="toc-number">4.1.4.</span> <span class="toc-text">广播表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8"><span class="toc-number">4.1.5.</span> <span class="toc-text">单表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9"><span class="toc-number">4.2.</span> <span class="toc-text">数据节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%87%E5%8C%80%E5%88%86%E5%B8%83"><span class="toc-number">4.2.1.</span> <span class="toc-text">均匀分布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E5%B8%83"><span class="toc-number">4.2.2.</span> <span class="toc-text">自定义分布</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%89%87"><span class="toc-number">4.3.</span> <span class="toc-text">分片</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%89%87%E9%94%AE"><span class="toc-number">4.3.1.</span> <span class="toc-text">分片键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%89%87%E7%AE%97%E6%B3%95"><span class="toc-number">4.3.2.</span> <span class="toc-text">分片算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%88%86%E7%89%87%E7%AE%97%E6%B3%95"><span class="toc-number">4.3.3.</span> <span class="toc-text">自动化分片算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E7%89%87%E7%AE%97%E6%B3%95"><span class="toc-number">4.3.4.</span> <span class="toc-text">自定义分片算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%89%87%E7%AD%96%E7%95%A5"><span class="toc-number">4.3.5.</span> <span class="toc-text">分片策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1"><span class="toc-number">4.3.6.</span> <span class="toc-text">强制分片路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">4.4.</span> <span class="toc-text">行表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE"><span class="toc-number">4.5.</span> <span class="toc-text">分布式主键</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A8%E6%89%8B%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%88%86%E8%A1%A8"><span class="toc-number">5.</span> <span class="toc-text">动手实现数据分表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-number">5.1.</span> <span class="toc-text">准备数据库 &amp; 表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%94%A8%E6%88%B7%E6%8C%81%E4%B9%85%E5%B1%82%E4%BB%A3%E7%A0%81"><span class="toc-number">5.2.</span> <span class="toc-text">开发用户持久层代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5-shardingsphere-jdbc"><span class="toc-number">5.3.</span> <span class="toc-text">引入 ShardingSphere-JDBC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%88%86%E8%A1%A8%E6%95%88%E6%9E%9C"><span class="toc-number">5.4.</span> <span class="toc-text">测试分表效果</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/distributed-microservices/%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA&%E7%AE%97%E6%B3%95&%E5%8D%8F%E8%AE%AE/" rel="bookmark" title="分布式理论&算法&协议">分布式理论&算法&协议</a></li><li><a href="/distributed-microservices/%E5%88%86%E5%B8%83%E5%BC%8FID&%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81&%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" rel="bookmark" title="分布式ID&分布式锁&分布式事务&分布式配置中心">分布式ID&分布式锁&分布式事务&分布式配置中心</a></li><li><a href="/distributed-microservices/API%E7%BD%91%E5%85%B3&SpringCloud%20Gateway/" rel="bookmark" title="API网关 & SpringCloud Gateway">API网关 & SpringCloud Gateway</a></li><li class="active"><a href="/distributed-microservices/ShardingSphere/" rel="bookmark" title="ShardingSphere">ShardingSphere</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="范特东东东" data-src="/images/avatar.jpg"><p class="name" itemprop="name">范特东东东</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">63</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">22</span> <span class="name">分类</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hqeDE1OQ==" title="https:&#x2F;&#x2F;github.com&#x2F;hjx159"><i class="ic i-github"></i></span> <span class="exturl item xiaohongshu" data-url="aHR0cHM6Ly93d3cueGlhb2hvbmdzaHUuY29tL3VzZXIvcHJvZmlsZS81ZTAyYzhhZDAwMDAwMDAwMDEwMDFmM2U=" title="https:&#x2F;&#x2F;www.xiaohongshu.com&#x2F;user&#x2F;profile&#x2F;5e02c8ad0000000001001f3e"><i class="ic i-xiaohongshu2"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjgxMjE0MzI4MEBxcS5jb20=" title="mailto:812143280@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/categories/photography/" rel="section"><i class="ic i-photography"></i>摄影</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于我</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/mq/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/photography/%E7%B4%AB%E7%AB%B9%E9%99%A2%E5%85%AC%E5%9B%AD/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-knowledge/" title="分类于 Java基础-知识点">Java基础-知识点</a></div><span><a href="/java/java-se/java-knowledge/%E5%B0%9A%E7%A1%85%E8%B0%B7_%E5%AE%8B%E7%BA%A2%E5%BA%B7_%E7%AC%AC15%E7%AB%A0_File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/" title="宋红康_第15章_File类与IO流">宋红康_第15章_File类与IO流</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-knowledge/" title="分类于 Java基础-知识点">Java基础-知识点</a></div><span><a href="/java/java-se/java-knowledge/%E5%B0%9A%E7%A1%85%E8%B0%B7_%E5%AE%8B%E7%BA%A2%E5%BA%B7_%E7%AC%AC11%E7%AB%A0_%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%92%8C%E5%9F%BA%E7%A1%80API/" title="宋红康_第11章_常用类和基础API">宋红康_第11章_常用类和基础API</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/photography/" title="分类于 摄影">摄影</a></div><span><a href="/photography/%E8%93%9D%E4%B8%8E%E9%BB%84/" title="蓝与黄">蓝与黄</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-knowledge/" title="分类于 Java基础-知识点">Java基础-知识点</a></div><span><a href="/java/java-se/java-knowledge/%E5%B0%9A%E7%A1%85%E8%B0%B7_%E5%AE%8B%E7%BA%A2%E5%BA%B7_%E7%AC%AC05%E7%AB%A0_%E6%95%B0%E7%BB%84/" title="宋红康_第05章_数组">宋红康_第05章_数组</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-excise/" title="分类于 Java基础-真题">Java基础-真题</a></div><span><a href="/java/java-se/java-excise/%E7%AC%AC12%E7%AB%A0%EF%BC%9A%E9%9A%8F%E5%A0%82%E5%A4%8D%E4%B9%A0%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98%EF%BC%88%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%EF%BC%89/" title="宋红康_第12章：集合框架">宋红康_第12章：集合框架</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/mq/" title="分类于 消息队列">消息队列</a></div><span><a href="/mq/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" title="消息队列">消息队列</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-excise/" title="分类于 Java基础-真题">Java基础-真题</a></div><span><a href="/java/java-se/java-excise/%E7%AC%AC01%E7%AB%A0%EF%BC%9A%E9%9A%8F%E5%A0%82%E5%A4%8D%E4%B9%A0%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98%EF%BC%88Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0%EF%BC%89/" title="宋红康_第01章：Java语言概述">宋红康_第01章：Java语言概述</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/juc/" title="分类于 JUC">JUC</a></div><span><a href="/java/juc/JUC%E7%AC%94%E8%AE%B0/" title="JUC 笔记">JUC 笔记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-knowledge/" title="分类于 Java基础-知识点">Java基础-知识点</a></div><span><a href="/java/java-se/java-knowledge/%E5%B0%9A%E7%A1%85%E8%B0%B7_%E5%AE%8B%E7%BA%A2%E5%BA%B7_%E7%AC%AC02%E7%AB%A0_%E5%8F%98%E9%87%8F%E4%B8%8E%E8%BF%90%E7%AE%97%E7%AC%A6/" title="宋红康_第02章_变量与运算符">宋红康_第02章_变量与运算符</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/database/" title="分类于 数据库">数据库</a> <i class="ic i-angle-right"></i> <a href="/categories/database/elasticsearch/" title="分类于 Elasticsearch">Elasticsearch</a></div><span><a href="/database/elasticsearch/Elasticsearch-JavaGuide/" title="Elasticsearch-JavaGuide">Elasticsearch-JavaGuide</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">范特东东东 @ fantedong</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">2m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">29:36</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"distributed-microservices/ShardingSphere/",favicon:{show:"(●´3｀●)欢迎回来",hide:"(〃＞皿＜)你快回来"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->