<!-- build time:Sat Apr 13 2024 20:42:19 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="水文 & 摄影" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="水文 & 摄影" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="水文 & 摄影" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="http://example.com/java/design-patterns/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E4%B8%8E%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><title>设计原则与设计模式 - 设计模式 - Java | fantedong = 水文 & 摄影 = 为了能更好地查看图片，你需要一点魔法</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">设计原则与设计模式</h1><div class="meta"><span class="item" title="创建时间：2024-03-08 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-03-08T00:00:00+08:00">2024-03-08</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>47k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>43 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">fantedong</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20220520174508815.png"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/java/" itemprop="item" rel="index" title="分类于 Java"><span itemprop="name">Java</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/java/design-patterns/" itemprop="item" rel="index" title="分类于 设计模式"><span itemprop="name">设计模式</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/java/design-patterns/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E4%B8%8E%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="范特东东东"><meta itemprop="description" content="为了能更好地查看图片，你需要一点魔法, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="水文 & 摄影"></span><div class="body md" itemprop="articleBody"><h1 id="软件设计原则有哪些"><a class="anchor" href="#软件设计原则有哪些">#</a> （软件）设计原则有哪些</h1><p>常⽤的⾯向对象设计原则包括<font color="red">7 个</font>，这些原则并不是孤⽴存在的，它们相互依赖，相互补充。</p><table><thead><tr><th>设计原则</th><th>英文</th><th>简单定义</th></tr></thead><tbody><tr><td>开闭原则</td><td>Open Closed Principle（OCP）</td><td><font color="red">对扩展开放，对修改关闭</font></td></tr><tr><td>单⼀职责原则</td><td>Single Responsibility Principle（SRP）</td><td>⼀个类只负责⼀个功能领域中的相应职责</td></tr><tr><td>里氏替换原则</td><td>Liskov Substitution Principle（LSP）</td><td>所有引用基类的地方，必须能透明地使用其子类的对象</td></tr><tr><td>依赖倒置原则</td><td>Dependency Inversion Principle（DIP）</td><td>面向<font color="red">抽象 / 接口</font>编程，而非面向具体实现类，让上层不再依赖下层</td></tr><tr><td>接口隔离原则</td><td>Interface Segregation Principle（ISP）</td><td>类之间的依赖关系应该建立在最小的接口上</td></tr><tr><td>合成 / 聚合复用原则</td><td>Composite/Aggregate Reuse Principle（C/ARP）</td><td>尽量使用合成 / 聚合，而不是通过继承达到复用的目的</td></tr><tr><td>最少知识原则 / 迪米特法则</td><td>Least Knowledge Principle（LKP）/Law of Demeter（LOD）</td><td>一个软件实体应当尽可能少的与其他实体发生相互作用</td></tr></tbody></table><h1 id="设计模式简介"><a class="anchor" href="#设计模式简介">#</a> 设计模式简介</h1><p>设计模式 (Design pattern) 代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。</p><p>设计模式是一套被反复使用的、多数人知晓的、经过分类编目的、代码设计经验的总结，是经过广泛接受、验证有效的解决问题的方法。<strong>使用设计模式是为了重用代码、让代码更易于理解、保证代码可靠性</strong>。毫无疑问，设计模式于己于他人于系统都是多赢的，设计模式使代码编制真正工程化，设计模式是软件工程的基石，如同大厦的一块块砖石一样。项目中合理地运用设计模式可以完美地解决很多问题，每种模式在现实中都有相应的原理来与之对应，每种模式都描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案，这也是设计模式能被广泛应用的原因。</p><h1 id="设计模式的分类"><a class="anchor" href="#设计模式的分类">#</a> 设计模式的分类</h1><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20220520174508815.png" alt="image-20220520174508815"></p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240308140318516.png" alt="image-20240308140318516"></p><p>设计模式主要分为 3 大类，24 小种。</p><ul><li><p><strong>创建型</strong>（Creational）：在创建对象的同时<font color="red"><strong><font color="red">隐藏对象的创建逻辑</font></strong>，不直接使用 new 来实例化对象</font>，程序在判断需要创建哪些对象时更灵活。</p><ul><li><strong><font color="gree">单例模式</font></strong>（Singleton）：确保一个类<font color="red">只有一个实例</font>，提供全局访问点。例如配置管理、日志管理等。</li><li><strong><font color="gree">简单工厂模式</font></strong>：<font color="red">由工厂对象来创建实例</font>，根据<font color="red">传入的参数</font>决定创建哪种产品类的实例。</li><li><strong><font color="gree">工厂方法模式</font></strong>（Factory Method）：定义一个创建对象的<font color="red">抽象工厂</font>，内部声明了产品的<font color="red">生产接口</font>，将生产任务交给不同的<font color="red">派生类工厂</font>，让它们决定实例化哪个类。</li><li><strong><font color="gree">抽象工厂模式</font></strong>（Abstract Factory）：提供一个<font color="red">创建一系列相关或相互依赖对象</font>的接口，而无需指定它们具体的类。</li><li><strong><font color="gree">建造者模式</font></strong>（Builder）：将一个<font color="red">复杂对象</font>的构建过程与其表示分离，封装对象的构建过程，使同样的构建过程可以创建不同的表示。</li><li><font color="gree">原型模式</font>（Prototype）：通过<font color="red">复制现有实例</font>来创建新实例。</li></ul></li><li><p><strong>结构型</strong>（Structural）：**<font color="red">通过类和接口间的继承和引用</font>** 实现创建复杂结构的对象。</p><ul><li><strong><font color="gree">适配器模式</font></strong>（Adapter）：将一个类的<font color="red">接口转换</font>成客户希望的另一个接口，适用于接口不兼容的场景。</li><li><strong><font color="gree">桥接模式</font></strong>（Bridge）：<font color="red">将抽象和对应实现进行解耦，使得二者可以独立地变化</font></li><li><strong><font color="gree">组合模式</font></strong>（Composite）：又叫做<font color="red">部分 - 整体模式</font>，使得客户端看来单个对象和对象的组合是同等的。换句话说，<font color="red">某个类型的方法同时也接受自身类型作为参数</font>。</li><li><strong><font color="gree">装饰器模式</font></strong>（Decorator）：<font color="red">动态地给一个对象添加额外的属性 / 功能</font>，而不希望影响其他对象时。</li><li><font color="gree">外观模式</font>（Facade）：为子系统中的一组接口<font color="red">提供一个统一的高层接口</font>。适用于简化复杂系统的场景。</li><li><strong><font color="gree">享元模式</font></strong>（Flyweight）：<font color="red">通过共享对象来减少内存占用</font>，适用于<font color="red">大量相似对象</font>的场景。可以共享一部分相同状态的对象以减少内存占用，如果有相同的业务请求，直接返回在内存中已有的对象，<font color="red">避免重新创建</font>。</li><li><strong><font color="gree">代理模式</font></strong>（Proxy）：为其他对象提供一种代理，以<font color="red">控制对其的访问</font>。适用于权限控制、延迟加载等场景。</li></ul></li><li><p><strong>行为型</strong>（Behavioral）：<strong><font color="red">通过类之间的不同通信方式实现不同行为</font></strong>。</p><ul><li><strong><font color="gree">模板方法方法</font></strong>（Template）：定义一个操作中的算法的骨架，而<font color="red">将一些步骤延迟到子类中实现</font>。使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤的实现方式。</li><li><font color="gree">策略模式</font>（Strategy）：<font color="red">定义一系列算法</font>，将每个算法封装起来，并使它们可以互换。例如当一个类有多个行为，而且这些行为在运行时可以相互替代时，可以使用策略模式。</li><li><font color="gree">状态模式</font>（State）：允许对象在其<font color="red">内部状态发生变化时</font>，改变它的行为。当一个对象的行为取决于它的状态，并且它在运行时可以切换状态时，可以使用状态模式。</li><li><strong><font color="gree">观察者模式</font></strong>（Observer）：定义对象间<font color="red">一对多</font>的依赖关系，使得每当一个对象状态发生改变时，<font color="red">所有依赖于它的对象都得到通知并自动更新</font>。</li><li><font color="gree">命令模式</font>（Command）：<font color="red">将一个请求 / 操作封装成一个对象</font>，从而让你使用不同的请求把客户端参数化，对请求排队或者记录请求日志，可以提供命令的撤销和恢复功能。例如 GUI、操作系统命令调用、需要对行为进行记录、撤销或重做、事务等处理。</li><li><strong><font color="gree">责任链模式</font></strong>（Chain of Responsibility）：<font color="red">为请求创建一条由多个接收者对象组成的链，并将请求沿着这条链传递，直到有对象处理它为止</font>。当系统中有多个对象可以处理同一请求，但具体哪个对象处理由运行时决定。使多个对象都有机会处理请求，从而避免了请求的发送者和接收者之间的耦合关系。例如拦截器、过滤器、数据清洗、规则引擎等。</li><li><font color="gree">解释器模式</font>（Interpreter）：给定一门语言，定义它的一种语法，并定义一个解释器，该解释器使用该语法来<font color="red">解释语言中的句子</font>。例如正则匹配、规则引擎、将字符串解析成对象等。</li><li><font color="gree">迭代器模式</font>（Iterator）：<font color="red">提供一个一致的方法来顺序访问集合中的各个元素，而该方法与集合的底层具体实现无关</font>。例如异构集合统一遍历方式。</li><li><font color="gree">中介者模式</font>（Mediator）：<font color="red">用一个中介对象来封装一系列的对象交互</font>，使得其他对象之间不需要显示地相互作用，而且可以独立地改变它们之间的交互。当系统中的多个对象之间存在复杂的相互依赖关系，而且这些关系难以维护时，可以使用中介者模式，例如聊天室、GUI 组件之间的通信等。</li><li><font color="gree">备忘录模式</font>（Memento）：在不破坏封装性的前提下，<font color="red">捕获一个对象的内部状态快照，并在该对象之外保存这个状态</font>，这样以后就可以将该对象恢复到原先保存的状态。例如撤销、恢复、历史记录等。</li><li><font color="gree">访问者模式</font>（Visitor）：表示一个作用于某对象结构中的各元素的操作，它使你可以在不改变各元素类的前提下定义作用于这些元素的新操作。适用于：需要对一个对象结构中的各元素进行不同的操作，但是不希望在该对象的类中添加这些操作时。</li></ul></li></ul><h1 id="单例模式"><a class="anchor" href="#单例模式">#</a> 单例模式</h1><h2 id="定义与特点"><a class="anchor" href="#定义与特点">#</a> 定义与特点</h2><p>单例模式属于<font color="gree">创建型</font>模式，<strong><font color="red">单例类在任何情况下都只存在一个实例</font></strong>，特点如下：</p><ul><li><font color="cornflowerblue">私有的构造方法</font></li><li><font color="cornflowerblue">私有的静态变量</font>：存储实例</li><li><font color="cornflowerblue">公有的静态方法</font>：获取实例</li></ul><p>在我们的系统中，有一些对象其实我们只需要一个，比如说：<font color="red">线程池、缓存、对话框、注册表、日志对象、充当打印机、显卡等设备驱动程序的对象</font>。事实上，这一类对象只能有一个实例，如果制造出多个实例就可能会导致一些问题的产生，比如：程序的行为异常、资源使用过量、或者不一致性的结果。</p><p>单例模式的好处：</p><ul><li><p><font color="red">全局访问</font>：单例对象可以在应用程序的任何地方被访问，而不需要传递对象的引用。这样可以方便地共享对象的状态和功能，简化了对象之间的通信和协作。</p></li><li><p><font color="red">节省资源</font>：对于频繁使用的对象，可以节省重复创建对象所花费的开销，这对于那些重量级对象而言，是非常可观的一笔系统开销；</p></li><li><p><font color="red">减轻 GC 压力</font>：由于 new 操作的次数减少，因而对系统内存的使用频率也会降低，这将减轻 GC 压力，缩短 GC 停顿时间。</p></li></ul><h2 id="常见写法"><a class="anchor" href="#常见写法">#</a> 常见写法</h2><h3 id="饿汉式线程安全"><a class="anchor" href="#饿汉式线程安全">#</a> 饿汉式（线程安全）</h3><p><strong><font color="red">类在加载时就直接创建单例实例</font></strong>。</p><p>优点：<font color="red">线程安全，不用加锁</font>，执行效率高。</p><blockquote><p>基于<font color="red">类加载机制</font>避免了多线程的同步问题，但是如果类被不同的类加载器加载就会创建不同的实例。</p></blockquote><p>缺点：<font color="red">易产生垃圾对象，浪费内存空间</font>。</p><p>代码实现：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 饿汉式单例测试</pre></td></tr><tr><td data-num="3"></td><td><pre> *</pre></td></tr><tr><td data-num="4"></td><td><pre> * @className: Singleton</pre></td></tr><tr><td data-num="5"></td><td><pre> * @date: 2021/6/7 14:32</pre></td></tr><tr><td data-num="6"></td><td><pre> */</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 1、私有化构造⽅法</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 2、定义⼀个私有的静态变量，指向自己类型</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 3、对外提供⼀个公有的静态方法，获取实例</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这种情况的单例模式<font color="red">容易被反射破坏</font>：</p><blockquote><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240309161137415.png" alt="image-20240309161137415"></p></blockquote><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 使用反射破坏单例</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment">// 获取空参构造方法（通过反射机制可以调用内部的 private 属性 / 方法 / 构造器）</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Singleton</span><span class="token punctuation">></span></span> declaredConstructor <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">// 将空参构造方法设置为强制访问</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        declaredConstructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// 创建实例</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">Singleton</span> singleton <span class="token operator">=</span> declaredConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>		</pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"反射创建的实例"</span> <span class="token operator">+</span> singleton<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"正常创建的实例"</span> <span class="token operator">+</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"正常创建的实例"</span> <span class="token operator">+</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输入结果如下，可见<font color="red">创建了多个单例实例</font>：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>反射创建的实例</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>single<span class="token punctuation">.</span></span>Singleton</span><span class="token annotation punctuation">@6267c3bb</span></pre></td></tr><tr><td data-num="3"></td><td><pre>正常创建的实例</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>single<span class="token punctuation">.</span></span>Singleton</span><span class="token annotation punctuation">@533ddba</span></pre></td></tr><tr><td data-num="5"></td><td><pre>正常创建的实例</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>single<span class="token punctuation">.</span></span>Singleton</span><span class="token annotation punctuation">@533ddba</span></pre></td></tr></table></figure><h3 id="懒汉式线程不安全"><a class="anchor" href="#懒汉式线程不安全">#</a> 懒汉式（线程不安全）</h3><p><strong><font color="red">使用的时候再创建单例实例</font></strong>。</p><p>优点：懒加载</p><p>缺点：<font color="red">线程不安全</font>，在多线程环境是无法保证单例的</p><p>代码实现:</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 懒汉式单例，线程不安全</pre></td></tr><tr><td data-num="3"></td><td><pre>*</pre></td></tr><tr><td data-num="4"></td><td><pre> * @className: Singleton</pre></td></tr><tr><td data-num="5"></td><td><pre> * @date: 2021/6/7 14:32</pre></td></tr><tr><td data-num="6"></td><td><pre> */</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 1、私有化构造⽅法</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 2、定义⼀个私有的静态变量，指向自身类型</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 3、对外提供⼀个公共的⽅法，获取实例</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">// 判断为 null 的时候再创建对象</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">// 判断为 not null 的时候直接返回对象</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font color="red">容易被多线程破坏</font>，测试代码如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"多线程创建的单例："</span> <span class="token operator">+</span>  <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出结果如下，可见<font color="red">创建了多个单例实例</font>：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>多线程创建的单例：</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>single<span class="token punctuation">.</span></span>Singleton</span><span class="token annotation punctuation">@18396bd5</span></pre></td></tr><tr><td data-num="3"></td><td><pre>多线程创建的单例：</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>single<span class="token punctuation">.</span></span>Singleton</span><span class="token annotation punctuation">@7f23db98</span></pre></td></tr><tr><td data-num="5"></td><td><pre>多线程创建的单例：</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>single<span class="token punctuation">.</span></span>Singleton</span><span class="token annotation punctuation">@5000d44</span></pre></td></tr></table></figure><h3 id="懒汉式线程安全"><a class="anchor" href="#懒汉式线程安全">#</a> <mark>懒汉式（线程安全）</mark></h3><h4 id="方式一synchronized-加锁"><a class="anchor" href="#方式一synchronized-加锁">#</a> 方式一：synchronized 加锁</h4><p><strong><font color="red">通过 <code>synchronized</code> 关键字加锁来保证线程安全</font></strong>，既可以添加在方法上面，也可以添加在代码块上面。</p><p>优点：懒加载，线程安全</p><p>缺点：<font color="red">每一次调用 getInstance () 获取实例时都需要加锁和释放锁</font>，效率较低</p><p>这里演示将 synchronized 关键字添加在方法上面，代码实现如下:</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 懒汉式单例，⽅法上⾯添加 synchronized 保证线程安全</pre></td></tr><tr><td data-num="3"></td><td><pre>*</pre></td></tr><tr><td data-num="4"></td><td><pre> * @className: Singleton</pre></td></tr><tr><td data-num="5"></td><td><pre> * @date: 2021/6/7 14:32</pre></td></tr><tr><td data-num="6"></td><td><pre> */</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 1、私有化构造⽅法</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 2、定义⼀个私有的静态变量，指向⾃⼰类型</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 3、对外提供⼀个公共的方法，获取实例（添加 synchronized 关键字加锁）</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="方式二双重检查锁dcl"><a class="anchor" href="#方式二双重检查锁dcl">#</a> 方式二：双重检查锁（DCL）</h4><blockquote><p>double-checked locking</p></blockquote><p><strong><font color="red">双重检查指的是两次空判断，锁指的仍然是 <code>synchronized</code> 加锁</font></strong>。</p><p>优点︰懒加载，线程安全，效率较高</p><p>缺点︰实现较复杂</p><p>代码实现如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 双重检查锁（DCL， 即 double-checked locking）</pre></td></tr><tr><td data-num="3"></td><td><pre>*</pre></td></tr><tr><td data-num="4"></td><td><pre> * @className: Singleton</pre></td></tr><tr><td data-num="5"></td><td><pre> * @date: 2021/6/7 14:32</pre></td></tr><tr><td data-num="6"></td><td><pre> */</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 1、私有化构造⽅法</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 2、定义⼀个私有的静态变量，指向自己类型（volatile 表明该变量是共享且不稳定的，可以避免线程从自己工作内存的高速缓存中读写变量的值，要求每次读写都需要到主内存中进行，从而保证变量的线程可见性；此外，编译器和处理器会禁止对该 volatile 修饰的变量进行指令重排，从而保证程序在多线程环境下的正确性）</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 3、对外提供⼀个公共的静态方法，获取实例</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">// 第⼀重检查是否为 null</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token comment">// 使用 synchronized 加锁！！！！！！！</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token comment">// 第⼆重检查是否为 null</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                    <span class="token comment">//new 关键字创建对象不是原子操作</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>第一重空判断：</p><ul><li><p>如果实例已经存在，就直接返回这个实例，不再需要进行同步操作</p></li><li><p>如果实例还没创建，才会进入同步块去创建实例</p><blockquote><p>同步块：目的是为了防止有多个线程同时调用导致生成多个实例，使得每次只能有一个线程访问同步块内容。当第一个线程抢到锁的调用获取了实例之后，这个实例就会被创建，之后其他线程的所有调用都不会进入同步块，直接在第一重判断就返回了单例。</p></blockquote></li></ul><p>第二重空判断：当多个线程一起到达锁位置时，进行锁竞争，其中一个线程获取锁，如果是第一次进入则为 null，则会创建单例对象，然后释放锁。<strong><font color="red">其他线程获取锁后，就会被第二重空判断拦截，从而直接返回已创建的单例对象</font></strong>。</p><p>其中最关键的一个点就是 <code>volatile</code> 关键字的使用，被它修饰的变量意味着是共享且不稳定的，会拥有两个特性：</p><ul><li><p><strong><font color="red">线程可见性</font></strong>：可以避免线程从自己本地内存的高速缓存中读写变量副本的值，而是<font color="red">强制到主内存中读写该变量本身的值</font>，从而保证该变量的线程可见性。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/jmm2.png" alt="JMM(Java 内存模型)强制在主存中进行读取"></p></li><li><p><strong><font color="red">禁止指令重排</font></strong>：JVM 为了优化，会在不影响正确性的前提下，调整代码的执行顺序，但在多线程下指令重排会影响正确性！但是，<font color="red">编译器和处理器会禁止对 <code>volatile</code> 修饰的变量进行指令重排，从而保证程序在多线程环境下的正确性</font>。</p></li></ul><p>因此就能理解这里为什么要使用 volatile 了，因为 **<font color="red"> new 关键字创建对象的过程不是原子操作</font>**， <code>instance = new Singleton();</code> 这行代码分为三步执行：</p><ol><li>在堆内存中为 <code>instance</code> 分配内存空间</li><li>调用构造方法，初始化对象 <code>instance</code></li><li>将 <code>instance</code> 指向分配的内存地址</li></ol><p>对应字节码指令如下（17、20、21、24）：</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240309193545865.png" alt="image-20240309193545865"></p><p>由于 JVM 具有指令重排的特性，执行顺序有可能变成 1-&gt;3-&gt;2。<font color="red">指令重排在单线程环境下不会出现问题，但是在多线程环境下会导致一个线程获得还没有初始化的实例</font>。例如，线程 T1 执行了 1 和 3，此时 T2 调用 getInstance () 后在第一重空判断发现 instance 不为空，因此直接返回 instance ，<font color="red">但此时 instance 还未被初始化</font>，这就是著名的 <strong>DCL 失效问题</strong>。</p><p>当我们在引用变量上面添加 volatile 关键字以后，会<font color="red">通过在创建对象指令的前后添加内存屏障来禁止指令重排序</font>，就可以避免这个问题。而且对 volatile 修饰的<font color="red">变量的修改对其他任何线程都是可见的</font>。</p><h4 id="方式三静态内部类"><a class="anchor" href="#方式三静态内部类">#</a> 方式三：静态内部类</h4><p>优点：<font color="red">懒加载、线程安全、效率较高、实现简单</font></p><p>代码实现：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 静态内部类实现单例</pre></td></tr><tr><td data-num="3"></td><td><pre>*</pre></td></tr><tr><td data-num="4"></td><td><pre> * @className: Singleton</pre></td></tr><tr><td data-num="5"></td><td><pre> * @date: 2021/6/7 14:32</pre></td></tr><tr><td data-num="6"></td><td><pre> */</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 1、私有化构造⽅法</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 2、对外提供获取实例的公共静态方法</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">InnerClass</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span> <span class="token comment">// 返回静态内部类的静态成员变量！</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 3、定义私有的静态内部类</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">InnerClass</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token comment">// 私有的静态变量</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><hr><p>懒加载如何理解？</p><p>首先，了解一下<strong>类的生命周期</strong>。类是在运行期间<font color="red">第一次使用时才动态加载</font>的（不使用不加载），而不是一次性加载所有类，因为一次性加载会占用很多的内存，<font color="red">加载的类信息存放于方法区中</font>。类从被加载到虚拟机内存中开始，到卸载出内存为止，类的生命周期可概括为 7 个阶段，如下图所示。</p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/lifecycle-of-a-class.png" alt="一个类的完整生命周期" style="zoom:67%"><p>其中，<font color="red">虚拟机加载 Class 文件的过程主要分为三步：加载、链接、初始化</font>。《虚拟机规范》要求<font color="red"><u>有且仅有</u>以下 5 种 “<strong>类的主动引用</strong>” 情况，必须立即对类进行初始化</font>：</p><ol><li>遇到 <code>new</code> 、 <code>getstatic</code> 、 <code>putstatic</code> 、 <code>invokestatic</code> 这 4 条字节码指令时，分别对应以下 Java 代码场景：<ul><li><font color="red">使用 new 关键字实例化对象</font></li><li><font color="red">读取 / 设置一个类的静态字段</font>（ <code>final</code> 修饰除外，被 final 修饰的静态字段是常量，已在编译期把结果放入常量池）</li><li><font color="red">调用一个类的静态方法</font></li></ul></li><li>使用 <code>java.lang.reflect</code> 包方法对类进行<font color="red">反射调用</font>的时候。</li><li>当初始化一个类的时候，如果发现其<font color="red">父类还没有初始化</font>，则需要先触发其父类的初始化。</li><li>当虚拟机启动时，用户需要指定一个<font color="red">要执行的主类</font>（包含 main () 的那个类)，虚拟机会先初始化这个主类。</li><li>当使用 JDK 1.7 的动态语言支持时，如果一个 <code>java.lang.invoke.MethodHandle</code> 实例最后的解析结果是 REF_getStatic 、REF_putStatic 、REF_invokeStatic 的方法句柄，则需要先触发这个方法句柄所对应的类的初始化。</li></ol><p><font color="red">除此之外的所有引用都不会立即对类进行初始化，称为<strong>类的被动引用</strong></font>。</p><p>首先了解一下线程共享的 <code>方法区</code> 。</p><ul><li><code>常量池表</code> ：<font color="red">JVM 为每个已加载的类维护一个常量池表，存储了类在<u>编译期间</u>生成的符号引用、字面量</font>。<ul><li>符号引用：类、字段、方法、接口等的符号引用</li><li>字面量：基本数据类型、String 类型常量、声明为 final 的常量值等</li></ul></li><li><code>运行时常量池</code> ：<ul><li><font color="red">常量池中的数据会在<u>对应类被加载</u>后放入运行时常量池</font></li><li><font color="red">类在<u>解析阶段</u>将这些符号引用替换成直接引用</font></li><li>除了在编译期生成的常量，还允许动态生成常量，例如 String 类的 intern ()</li></ul></li></ul><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/68747470733a2f2f7365617a65616e2e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f696d672f4a6176612f4a564d2d4a617661382545352538362538352545352541442539382545372542422539332545362539452538342545352539422542452e706e67" alt="img"></p><center>Java8 内存结构图</center><p>因此，Singleton 类不会在加载时就被初始化，那么当 Singleton 类的静态方法 getInstance () 被调用时，它才会被初始化。InnerClass 才会被放入 Singleton 的运行时常量池里，并把符号引用替换为直接引用，这时静态对象 INSTANCE 也真正被创建，然后再被 getInstance () 方法返回出去。</p><hr><p>线程安全如何实现？</p><p>在《深入理解 JAVA 虚拟机》中，有这么一句话:“虚拟机会保证一个类的<clinit>() 方法在多线程环境中被正确地加锁、同步。如果多个线程同时去初始化一个类，那么只会有一个线程去执行这个类的<clinit>() 方法，其他线程都需要阻塞等待，直到活动线程执行<clinit>() 方法完毕。如果在一个类的<clinit>() 方法中有耗时很长的操作，就可能造成多个进程阻塞（需要注意的是，其他线程虽然会被阻塞，但如果执行<clinit>() 方法后，其他线程唤醒之后不会再次进入<clinit>() 方法。同一个加载器下，一个类型只会初始化一次。)，在实际应用中，这种阻塞往往是很隐蔽的。”</clinit></clinit></clinit></clinit></clinit></clinit></p><hr><p>从上面的分析可以看出 INSTANCE 在创建过程中是线程安全的，所以说静态内部类形式的单例既可保证线程安全，也能保证单例的唯一性，同时也延迟了单例的实例化。</p><h3 id="枚举单例"><a class="anchor" href="#枚举单例">#</a> 枚举单例</h3><p>在 Java 中，<font color="red">枚举类与普通类一样，都能拥有字段与方法</font>，而且<font color="red">枚举类的实例创建是线程安全的，在任何情况下都是一个单例</font>，因此使用枚举类（ <code>enum</code> ）可以非常方便地实现单例模式：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span> <span class="token comment">//enum 表示枚举类</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token constant">INSTANCE</span><span class="token punctuation">;</span> <span class="token comment">// 这是枚举类的单个实例</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 在这里可以添加其他成员变量和方法</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 实现单例模式的操作</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Singleton instance is doing something."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在这个例子中，<strong><font color="red"> <code>Singleton</code> 是一个枚举类， <code>INSTANCE</code> 是该枚举类的单个实例。由于枚举类的特性，这个实例是在程序启动时被初始化（类似于饿汉式），并且在整个程序生命周期内只有一个</font></strong>。</p><p>使用时，可以通过 <code>Singleton.INSTANCE</code> 来访问单例对象，并调用其中的方法：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token comment">// 访问单例实例</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">Singleton</span> singleton <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        </pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">// 调用单例方法</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        singleton<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>特点：<font color="red">类似于饿汉式</font>，简单，高效，<strong><font color="red">线程安全</font></strong>，<strong><font color="red">可以避免通过反射破坏枚举单例</font></strong></p><ul><li><font color="red">枚举类天生就是线程安全的，且只会被加载一次</font></li><li>防止反射和反序列化时破坏单例的问题，因为<font color="red">枚举类型不会在反序列化时重新创建新的对象，会报错</font></li></ul><hr><center>枚举类的实例创建为什么是线程安全的？</center><p>利用 <code>javap</code> 命令反编译枚举类：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>javap <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span></pre></td></tr></table></figure><p>得到如下内容：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Compiled</span> from <span class="token string">"Singleton.java"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>Singleton</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>Singleton</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>Singleton</span> <span class="token constant">INSTANCE</span><span class="token punctuation">;</span> <span class="token comment">// INSTANCE 是 static final</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>Singleton</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>Singleton</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">static</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>从枚举类的反编译结果可以看到，<font color="red">INSTANCE 实例被 public static final 修饰（即公有静态常量），所以可以通过类名直接调用</font>。并且对象的实例是在静态代码块中创建的，因为 static 类型的属性会在类被加载之后被初始化，当一个 Java 类第一次被真正使用到的时候静态资源被初始化、<font color="red">Java 类的加载和初始化过程都是线程安全的，所以创建一个 enum 类型是线程安全的</font>。</p><hr><center>枚举类的实例为什么都是单例？为什么不会被反射破坏枚举单例？</center><p>尝试通过反射破坏枚举单例的代码如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">Singleton</span> singleton <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        singleton<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token string">"hello enum"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">// 尝试使⽤反射破坏单例</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 枚举类没有空参构造方法，反编译后可以看到枚举有⼀个两个参数的构造方法</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Singleton</span><span class="token punctuation">></span></span> declaredConstructor <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">// 设置强制访问</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        declaredConstructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// 创建实例，这里会报错，因为无法通过反射来创建枚举的实例</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">Singleton</span> enumSingleton <span class="token operator">=</span>declaredConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>enumSingleton<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>运行结果报错如下：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Exception <span class="token keyword">in</span> thread <span class="token string">"main"</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>java.lang.IllegalArgumentException: Cannot reflectively create enum objects </pre></td></tr><tr><td data-num="3"></td><td><pre>	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller<span class="token punctuation">(</span>Constructor.java:492<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>	at java.base/java.lang.reflect.Constructor.newInstance<span class="token punctuation">(</span>Constructor.java:480<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>	at com.spring.demo.singleton.Test.main<span class="token punctuation">(</span>Test.java:24<span class="token punctuation">)</span></pre></td></tr></table></figure><p>查看反射创建实例的 newInstance () ⽅法，有如下判断：</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240310123838943.png" alt="image-20240310123838943"></p><p>所以⽆法通过反射创建枚举的实例。</p><h2 id="优缺点"><a class="anchor" href="#优缺点">#</a> 优缺点</h2><p>优点：</p><ol><li><strong>唯一实例：</strong> 单例模式确保一个类只有一个实例，减少了开销，避免了多次实例化，保证了全局唯一性。</li><li><strong>延迟实例化：</strong> 单例模式可以实现延迟实例化，即在需要时才创建对象，提高了性能。</li><li><strong>全局访问：</strong> 单例模式允许全局访问该唯一实例，方便对该实例进行管理和调用。</li></ol><p>缺点：</p><ol><li><strong>可能引起性能问题：</strong> 如果单例对象在整个应用程序的生命周期内都存在，并频繁地被访问，可能会引起性能问题。</li><li><strong>全局状态：</strong> 单例模式引入了全局状态，可能导致程序的复杂性增加，难以进行单元测试。</li><li>** 难以扩展： ** 没有抽象层，与单一职责原则冲突</li></ol><h2 id="应用场景"><a class="anchor" href="#应用场景">#</a> 应用场景</h2><ul><li>** 资源共享：** 当某个资源只需要被系统中的一个对象共享时，使用单例模式可以确保对象的唯一性，例如数据库连接池、线程池等。</li><li>** 配置管理：** 单例模式可以用于管理全局的配置信息，确保系统中使用的配置信息是唯一的。</li><li>** 日志记录：** 在记录日志时，为了避免频繁地打开和关闭文件，可以使用单例模式来保持文件的打开状态。</li></ul><h1 id="工厂模式"><a class="anchor" href="#工厂模式">#</a> 工厂模式</h1><p>工厂模式均属于<font color="gree">创建型</font>设计模式。</p><h2 id="简单工厂模式"><a class="anchor" href="#简单工厂模式">#</a> 简单工厂模式</h2><p>目的是将客户程序与具体类解耦，<strong><font color="red">由⼀个工厂类来创建实例</font></strong>，根据传入工厂的不同参数来实例化不同产品类，不需要客户端关注创建逻辑。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240309140922573.png" alt="image-20240309140922573"></p><center>简单工厂模式的 UML 类图</center><p>优点：简单粗暴，适用于创建对象较少的情况。</p><p>缺点：<font color="red">如果要增加新产品，就需要修改工厂类的判断逻辑，违背开闭原则</font>。而且<font color="red">产品多的话会使工厂类比较复杂</font>。</p><p>举个例子， <code>Calendar</code> 抽象类的 getInstance 方法，调用 createCalendar 方法根据不同的地区参数创建不同的日历对象；Spring 中的 <code>BeanFactory</code> 使用简单工厂模式，根据传入一个唯一的标识来获得 Bean 对象。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnimalFactory</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Animal</span> <span class="token function">createAnimal</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"cat"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"dog"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"cow"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="工厂方法模式"><a class="anchor" href="#工厂方法模式">#</a> 工厂方法模式</h2><p>对简单工厂模式进行抽象，该模式 **<font color="red">定义了一个抽象工厂类，其内部声明了抽象的生产方法。具体要实例化哪个类由派生工厂类决定，它们通过继承该抽象工厂类并重写实现其内部抽象生产方法来实例化不同的产品类</font>**。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240309153832142.png" alt="image-20240309153832142"></p><center>工厂方法模式的 UML 类图</center><p>优点：不用通过指定产品类型来创建对象了，减轻了工厂类的负担，支持增加新产品，符合开放 - 封闭原则。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 抽象的动物工厂</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AnimalFactory</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Animal</span> <span class="token function">createAnimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 抽象的生产方法（接口）</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 具体的工厂实现类</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AnimalFactory</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 继承抽象工厂类</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Animal</span> <span class="token function">createAnimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 重写抽象工厂方法</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DogFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AnimalFactory</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Animal</span> <span class="token function">createAnimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="抽象工厂模式"><a class="anchor" href="#抽象工厂模式">#</a> 抽象工厂模式</h2><p>简单工厂模式和工厂方法模式不管怎么拆分 / 抽象工厂，都只是针对一类产品，如果要生成另一种产品，就比较难办了！因此，抽象工厂模式中<font color="red">抽象工厂类中定义了多类产品，而不是一类产品</font>。</p><p>抽象工厂模式通过 **<font color="red">在抽象工厂类中增加创建产品的抽象方法接口</font>**，并在具体子工厂中实现新加产品的创建，当然前提是子工厂支持生产该产品。否则继承的这个接口可以什么也不干。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240309153609323.png" alt="image-20240309153609323"></p><h2 id="优缺点-2"><a class="anchor" href="#优缺点-2">#</a> 优缺点</h2><p>优点：</p><ol><li><strong>封装对象创建：</strong> 工厂模式将对象的创建逻辑封装在工厂类中，客户端无需知道对象的具体实现细节，只需通过工厂获取对象。</li><li><strong>对象管理：</strong> 工厂模式集中了对象的管理，便于对对象的统一管理、维护和修改。</li><li><strong>解耦合：</strong> 工厂模式将客户端代码与具体类的实现解耦，使系统更易于扩展和维护。</li></ol><p>缺点：</p><ol><li><strong>类的数量增加：</strong> 引入工厂模式会增加类的数量，增加了系统的复杂性。</li><li><strong>不适合简单对象创建：</strong> 对于简单的对象创建，使用工厂模式可能会显得过于繁琐，不划算。在这种情况下，直接实例化对象可能更为简便。</li></ol><h2 id="应用场景-2"><a class="anchor" href="#应用场景-2">#</a> 应用场景</h2><ul><li>** 对象创建复杂：** 当对象的创建逻辑较为复杂，包含多个步骤或者依赖其他对象时，可以使用工厂模式将对象的创建过程封装起来。</li><li>** 避免直接实例化：** 当需要隐藏对象的具体实现，只提供接口时，可以使用工厂模式。客户端通过工厂获取对象，而不直接实例化。</li></ul><h2 id="小结"><a class="anchor" href="#小结">#</a> 小结</h2><ul><li>简单工厂：用<font color="red">一个工厂对象</font>生产同一等级结构中的任意产品。</li><li>工厂方法：提供<font color="red">多个派生工厂</font>，用来创建不同的对象。</li><li>抽象工厂：用多个派生工厂对象生产<font color="red">不同产品族</font>的全部产品。</li></ul><h1 id="适配器模式"><a class="anchor" href="#适配器模式">#</a> 适配器模式</h1><h2 id="定义"><a class="anchor" href="#定义">#</a> 定义</h2><p>在我们的应用程序中我们可能需要将两个不同接口的类来进行通信，在不修改这两个的前提下我们可能会需要某个中间件来完成这个衔接的过程，这个中间件就是适配器。所谓的适配器模式是一种<font color="gree">结构型</font>设计模式，<strong><font color="red">将一个类的接口，转换成客户端期望的另一个接口，允许接口不兼容的类之间能够相互合作</font></strong>。主要有三种主要形式：<font color="red">类适配器、对象适配器、接口适配器</font>。</p><h2 id="类适配器"><a class="anchor" href="#类适配器">#</a> 类适配器</h2><p>适配器（Adapter）继承了一个已有的类（Adaptee），并实现了目标接口（Target）。通过继承关系，适配器（Adapter）同时拥有原始类（Adaptee）的功能和目标接口（Target）的行为。</p><ul><li>Target：客户端 Client 真正期望的接口</li><li>Adaptee：需要进行适配的类，其中定义了一个已存在的接口</li><li>Adapter：<font color="red">对 Adaptee 和 Target 的接口进行适配，保证对 target 中接口的调用可以间接转换为对 Adaptee 中接口进行调用</font>。</li></ul><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240310143559846.png" alt="image-20240310143559846"></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 已有的类</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Adaptee</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Specific request from Adaptee."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 目标接口</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Target</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// 类适配器</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">Adaptee</span> <span class="token keyword">implements</span> <span class="token class-name">Target</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 实现 Target 接口中的方法</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">// 客户端使用</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">Target</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接口的多态性</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        target<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实际调用的是 Adapter 中定义的方法</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240310144118342.png" alt="image-20240310144118342"></p><h2 id="对象适配器"><a class="anchor" href="#对象适配器">#</a> 对象适配器</h2><p><strong><font color="red">适配器（Adapter）持有一个已有类（Adaptee）的实例（adaptee）【即：<font color="#B32015">类对象组合</font>】，并实现了目标接口（Target）</font></strong>。适配器（Adapter）通过委托的方式调用已有类（Adaptee）的功能（SpecificRequest ()），实现目标接口（Target）的行为（Request ()）。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240310145345382.png" alt="image-20240310145345382"></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 已有的类</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Adaptee</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Specific request from Adaptee."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 目标接口</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Target</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// 对象适配器</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">implements</span> <span class="token class-name">Target</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Adaptee</span> adaptee<span class="token punctuation">;</span> <span class="token comment">// 持有一个已有类的实例对象</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Adapter</span><span class="token punctuation">(</span><span class="token class-name">Adaptee</span> adaptee<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 构造方法</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>adaptee <span class="token operator">=</span> adaptee<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 实现 Target 接口的方法</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        adaptee<span class="token punctuation">.</span><span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过委托的方式调用已有类的方法</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">// 客户端使用</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token class-name">Adaptee</span> adaptee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adaptee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建已有类的实例</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token class-name">Target</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adapter</span><span class="token punctuation">(</span>adaptee<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接口的多态性</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        target<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="接口适配器"><a class="anchor" href="#接口适配器">#</a> 接口适配器</h2><p>接口适配器是一种特殊情况，其中 **<font color="red">适配器（Adapter）实现了目标接口（Target）的某个方法，但是它的方法体是空的</font><strong>。通过接口适配器，</strong><font color="red">子类可以选择性地覆盖感兴趣的方法</font>**，而不必实现所有的方法。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 目标接口</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Target</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 接口适配器</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">implements</span> <span class="token class-name">Target</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// 空实现，子类可以选择性地覆盖</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment">// 空实现，子类可以选择性地覆盖</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// 具体的适配器类</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ConcreteAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">Adapter</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Method1 implementation in ConcreteAdapter."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">// 客户端使用</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token class-name">Target</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        target<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用适配器的方法 1</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="优缺点-3"><a class="anchor" href="#优缺点-3">#</a> 优缺点</h2><p>优点：</p><ol><li>提高了类的复用</li><li>组合若干关联对象形成对外提供统一服务的接口</li><li>扩展性、灵活性好</li></ol><p>缺点：</p><ol><li>过多使用适配模式<font color="red">容易造成代码功能、逻辑意义的混淆</font>。</li><li>部分语言<font color="red">对继承的限制</font>，可能至多只能适配一个适配者类，而且目标类必须是抽象类。</li></ol><h2 id="应用场景-3"><a class="anchor" href="#应用场景-3">#</a> 应用场景</h2><ul><li>** 旧系统升级：** 当需要将旧系统中的组件集成到新系统中时，可能由于接口不兼容而无法直接使用。适配器模式可以将旧系统的接口适配成新系统期望的接口。</li><li>** 第三方组件使用：** 当使用某个第三方组件，但其接口与系统要求的接口不一致时，可以使用适配器模式进行适配。</li></ul><h1 id="代理模式"><a class="anchor" href="#代理模式">#</a> 代理模式</h1><h2 id="定义-2"><a class="anchor" href="#定义-2">#</a> 定义</h2><p>代理模式是一种<font color="gree">结构型</font>设计模式，其本质是一个中间件，<font color="red">目的是解耦合服务提供者和使用者</font>。<strong><font color="red">使用者通过代理间接地访问提供者，便于对后者的封装和控制</font></strong>。代理对象（Proxy）通常充当客户端（Client）和目标对象（RealSubject）之间的中介，起到控制、过滤和增强功能的作用。</p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/img016.png" alt="images" style="zoom:67%"><center>使用代理前</center><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/img017.png" alt="images" style="zoom:67%"><center>使用代理后</center><p>主要角色如下：</p><ul><li>Subject：定义 RealSubject 对外的接口，且必须被 Proxy 实现。这样外部调用 proxy 的接口最终都被转化为对 realsubject 的调用。</li><li>RealSubject：目标对象类。</li><li>Proxy：目标对象的代理类，负责控制和管理目标对象，并间接地传递外部对目标对象的访问。<ul><li>Remote Proxy（远程代理）：对本地的请求以及参数进行序列化，向远程对象发送请求，并对响应结果进行反序列化，将最终结果反馈给调用者；</li><li>Virtual Proxy（虚拟代理）：当目标对象的创建开销比较大的时候，可以使用延迟或者异步的方式创建目标对象或计算，直到真正需要使用时才创建目标对象。这可以用于优化性能，避免不必要的资源开销。</li><li>Protection Proxy（保护代理）：细化对目标对象访问权限的控制，以便限制客户端直接访问目标对象。这种代理常用于实现权限控制、缓存、日志等功能。</li></ul></li></ul><h2 id="静态代理"><a class="anchor" href="#静态代理">#</a> 静态代理</h2><p>静态代理：<strong><font color="red">在<u>编译时</u>就已经确定代理类（Proxy）和目标类（RealSubject）的关系</font></strong>，通过手动编写代理类的方式实现。静态代理需要<font color="red">为每个目标类编写一个对应的代理类，当目标类发生变化时，代理类也需要相应修改</font>。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240310152442937.png" alt="image-20240310152442937"></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 目标接口</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 目标类</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">RealSubject</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RealSubject handles the request."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// 代理类</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">RealSubject</span> realSubject<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token class-name">RealSubject</span> realSubject<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>realSubject <span class="token operator">=</span> realSubject<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Proxy handles the request before delegating to RealSubject."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        realSubject<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Proxy handles the request after delegating to RealSubject."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">// 客户端使用</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token class-name">RealSubject</span> realSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token class-name">Proxy</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>realSubject<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>        proxy<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="动态代理"><a class="anchor" href="#动态代理">#</a> 动态代理</h2><p>动态代理是 **<font color="red">在<u>运行时</u>生成代理类（Proxy），无需手动编写</font>**。Java 中的 <code>java.lang.reflect.Proxy</code> 和 <code>InvocationHandler</code> 接口提供了实现动态代理的机制。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 目标接口</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 目标类</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">RealSubject</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RealSubject handles the request."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 通过 InvocationHandler 接口实现动态代理</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DynamicProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">DynamicProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"DynamicProxy handles the request before delegating to RealSubject."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"DynamicProxy handles the request after delegating to RealSubject."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">// 客户端使用</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token class-name">RealSubject</span> realSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token class-name">InvocationHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicProxy</span><span class="token punctuation">(</span>realSubject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接口的多态性</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token class-name">Subject</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Subject</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                <span class="token class-name">Subject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">Subject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                handler</pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>        proxy<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="二者区别"><a class="anchor" href="#二者区别">#</a> 二者区别</h2><ol><li><p>灵活性：</p><ul><li><p><font color="red">静态代理中接口一旦新增加方法，目标对象和代理对象都要进行修改，这是非常麻烦的</font>!</p></li><li><p><font color="red">动态代理更加灵活，不是必须实现接口</font>，可以直接代理实现类，并且可以<font color="red">不需要针对每个目标类都创建一个代理类</font>。</p></li></ul></li><li><p>JVM 层面︰</p><ul><li><font color="red">静态代理在<u>编译时</u>就将接口、实现类、代理类这些都变成了一个个实际 的 class 文件</font>。</li><li><font color="red">动态代理是在<u>运行时</u>才动态生成类字节码，并加载到 JVM 中的</font>。</li></ul></li></ol><h2 id="优缺点-4"><a class="anchor" href="#优缺点-4">#</a> 优缺点</h2><p>优点：</p><ol><li>** 控制访问：** 代理模式可以<font color="red">控制对目标对象的访问</font>，提供了更灵活的权限控制。</li><li>** 增强功能：** 代理模式可以在目标对象的基础上<font color="red">增加额外的功能</font>，如日志记录、性能监控、缓存等。</li><li><strong>代理类型灵活：</strong><font color="red">可以根据需要选择使用不同类型的代理</font>，包括静态代理、动态代理、虚拟代理等。</li></ol><p>缺点：</p><ol><li>** 增加复杂性：** 引入代理类可能会增加系统的复杂性，<font color="red">特别是在静态代理中需要为每个目标类编写一个对应的代理类</font>。</li><li><strong>运行时开销：</strong><font color="red">动态代理在运行时生成代理类</font>，可能会带来一些运行时的性能开销。</li></ol><h2 id="应用场景-4"><a class="anchor" href="#应用场景-4">#</a> 应用场景</h2><ul><li>** 远程代理：** 当需要在不同地址空间中访问对象时，可以使用远程代理，使得客户端感觉像是在本地访问远程对象。</li><li>** 虚拟代理：** 当创建一个对象实例的开销很大时，可以使用虚拟代理来延迟对象的创建，只有在真正需要时才进行实例化。</li><li>** 安全控制：** 代理模式可以用于控制对真实对象的访问权限，实现安全控制。</li><li>** 日志记录：** 可以使用代理模式在调用真实对象的方法前后进行日志记录、性能监控等操作。</li></ul><h1 id="装饰器模式"><a class="anchor" href="#装饰器模式">#</a> 装饰器模式</h1><blockquote><p>好难啊！</p></blockquote><h2 id="定义-3"><a class="anchor" href="#定义-3">#</a> 定义</h2><p>装饰器模式是一种<font color="gree">结构型</font>设计模式，它允许 **<font color="red">通过将类对象包装在装饰器类的实例中，以期望在不改变类对象及其类定义的情况下，动态地为类对象添加额外的功能 / 属性</font><strong>。简单来说就是，</strong><font color="red">当我们需要修改原有的功能，但我们又不愿直接去修改原有的代码时，设计一个 Decorator 套在原有代码外面</font><strong>。该过程是通过调用被包裹之后的对象完成功能添加的，而<font color="red">不是直接修改现有对象的行为，相当于增加了中间层</font>。</strong><font color="red">通过创建一系列相互关联的装饰器类，逐步地添加新的功能</font>**，以达到对类的功能进行动态扩展的目的。</p><p>主要角色：</p><ol><li>** 组件（Component）：** 一个抽象接口，定义了具体组件 / 被装饰对象和装饰器类的共同接口。</li><li>** 具体组件 / 被装饰对象（ConcreteComponent）：** 实现组件接口的具体类，<font color="red">是被装饰的对象</font>。</li><li><strong>装饰器（Decorator）：</strong> <strong><font color="red">一个抽象类</font></strong>，<font color="red">包含一个指向组件对象的引用，并实现与组件接口一致的方法接口，以便可以替代组件</font>。装饰器也可以包含其他装饰器，形成一条装饰链。</li><li><strong>具体装饰器（ConcreteDecorator）：</strong><font color="red">继承装饰器类，并重写所有内部方法，还可以额外添加具体的功能</font>。</li></ol><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240310163316821.png" alt="image-20240310163316821"></p><p>代码例子：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 组件接口</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Coffee</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">double</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 具体组件（被修饰的）</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">SimpleCoffee</span> <span class="token keyword">implements</span> <span class="token class-name">Coffee</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"Simple Coffee"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">2.0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// 装饰器（抽象类！）</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CoffeeDecorator</span> <span class="token keyword">implements</span> <span class="token class-name">Coffee</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">protected</span> <span class="token class-name">Coffee</span> decoratedCoffee<span class="token punctuation">;</span> <span class="token comment">// 指向组件接口的对象</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">CoffeeDecorator</span><span class="token punctuation">(</span><span class="token class-name">Coffee</span> decoratedCoffee<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>decoratedCoffee <span class="token operator">=</span> decoratedCoffee<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 这是从 Coffee 接口实现的方法，而非抽象方法！</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">return</span> decoratedCoffee<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 这是从 Coffee 接口实现的方法，而非抽象方法！</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">return</span> decoratedCoffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">// 具体装饰器</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MilkDecorator</span> <span class="token keyword">extends</span> <span class="token class-name">CoffeeDecorator</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">MilkDecorator</span><span class="token punctuation">(</span><span class="token class-name">Coffee</span> decoratedCoffee<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">(</span>decoratedCoffee<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", with Milk"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment">// 具体装饰器</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">SugarDecorator</span> <span class="token keyword">extends</span> <span class="token class-name">CoffeeDecorator</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">SugarDecorator</span><span class="token punctuation">(</span><span class="token class-name">Coffee</span> decoratedCoffee<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">(</span>decoratedCoffee<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", with Sugar"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment">// 客户端使用</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token comment">// 创建一个简单的咖啡</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token class-name">Coffee</span> simpleCoffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Simple Coffee - Cost: $"</span> <span class="token operator">+</span> simpleCoffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token comment">// 添加牛奶装饰器</span></pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token class-name">Coffee</span> milkCoffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MilkDecorator</span><span class="token punctuation">(</span>simpleCoffee<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 包装</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Milk Coffee - Cost: $"</span> <span class="token operator">+</span> milkCoffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token comment">// 再添加糖装饰器</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token class-name">Coffee</span> milkSugarCoffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SugarDecorator</span><span class="token punctuation">(</span>milkCoffee<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Milk and Sugar Coffee - Cost: $"</span> <span class="token operator">+</span> milkSugarCoffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="优缺点-5"><a class="anchor" href="#优缺点-5">#</a> 优缺点</h2><p>优点：</p><ol><li><strong>灵活性高：</strong> 装饰模式允许在运行时<font color="red">动态地为对象添加新的功能</font>，而无需修改其代码。</li><li><strong>简化代码：</strong> <font color="red">比继承更灵活</font>，避免了通过子类继承来扩展功能的复杂性。</li><li><strong>易于扩展：</strong> 可以通过<font color="red">组合多个装饰器</font>实现复杂的功能组合。</li></ol><p>缺点：</p><ol><li>** 可能引入许多小对象：** 当装饰器过多时，可能引入大量小型对象，增加系统的复杂性。</li><li>** 理解难度：** 对于初学者来说，理解装饰器模式可能需要一些时间，特别是在有多个装饰器的情况下。</li></ol><h2 id="应用场景-5"><a class="anchor" href="#应用场景-5">#</a> 应用场景</h2><p>如果希望<font color="red">在无需修改代码的情况下即可使用对象，且希望在运行时为对象新增额外的行为</font>，可以使用装饰模式。</p><p>装饰能<font color="red">将业务逻辑组织为层次结构，可为各层创建一个装饰</font>，在运行时将各种不同逻辑组合成对象。<font color="red">由于这些对象都遵循<strong>通用接口</strong>，客户端代码能以<strong>相同的方式</strong>使用这些对象</font>。</p><p>如果用继承来扩展对象行为的方案难以实现或者根本不可行，你可以使用该模式。</p><p>许多编程语言使用 final 最终关键字来限制对某个类的进一步扩展。<font color="red">复用 final 类已有行为的唯一方法是使用装饰模式：用封装器对其进行封装</font>。</p><h2 id="通俗解释"><a class="anchor" href="#通俗解释">#</a> 通俗解释</h2><p>当我们使用装饰模式时，可以把它类比成<strong>给一杯咖啡加配料</strong>的过程。首先，有一杯简单的咖啡，这就是我们的基础组件。然后，我们可以为这杯咖啡加入不同的配料，比如牛奶和糖，而这些配料就是装饰器。</p><ol><li><p>** 基础咖啡（ConcreteComponent）：** 就像最开始的一杯普通咖啡，没有加任何配料。这是我们要装饰的基础对象。</p></li><li><p>** 牛奶装饰器（ConcreteDecorator）：** 现在我们想要在咖啡中加入牛奶，于是我们<font color="red">创建了一个 “牛奶装饰器” 来包装原始的咖啡</font>。这个装饰器知道如何计算咖啡价格，并在描述中加上 “with Milk”。</p></li><li><p>** 糖装饰器（ConcreteDecorator）：** 如果我们再想加入糖，我们可以再创建一个 “糖装饰器”，它会包装已经有牛奶的咖啡。这个装饰器也知道如何计算价格，并在描述中加上 “with Sugar”。</p></li></ol><p>这样，我们就可以动态地组合咖啡和各种配料，得到不同种类的咖啡，而不需要修改咖啡本身的类。这就是装饰模式的核心思想：通过将对象包装在装饰器中，逐步地添加新的功能，实现对对象功能的动态扩展。</p><h1 id="观察者模式"><a class="anchor" href="#观察者模式">#</a> 观察者模式</h1><h2 id="定义-4"><a class="anchor" href="#定义-4">#</a> 定义</h2><p>观察者模式是一种<font color="gree">行为型</font>设计模式，主要 **<font color="red">用于处理对象间的一对多的依赖关系</font>**，<font color="red">使得当一个对象的状态发生变化时，其所有关注者（依赖者）都会收到通知，以进行相应的处理</font>。</p><p>观察者模式主要涉及两个角色：Subject（目标）和 Observer（观察者）。Subject 负责维护一组观察者，而观察者则订阅 Subject，<font color="red">以便在 Subject 的状态发生变化时接收通知并执行相应的操作</font>。</p><p>主要组成部分：</p><ol><li>**Subject（目标 / 被观察者）：** 一个接口 / 抽象类，用于添加、删除和通知观察者。具体的目标对象维护了一组观察者，并在状态发生改变时通知观察者。</li><li>**ConcreteSubject（具体目标）：** 实现了 Subject 接口并重写了其中的方法，负责维护和管理观察者，并在状态变化时通知观察者。</li><li>**Observer（观察者）：** 一个接口 / 抽象类，用于接收 Subject 的通知。观察者中通常包含一个更新方法，用于在接收到通知时执行相应的操作。</li><li>**ConcreteObserver（具体观察者）：** 实现了 Observer 接口，它注册到具体目标，接收目标的通知，并在状态变化时执行具体的业务逻辑。</li></ol><p>下面是 GoF 介绍的典型的类观察者模式的 UML 类图：</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240310160236309.png" alt="image-20240310160236309"></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// Subject（目标）</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// ConcreteSubject（具体目标）</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ConcreteSubject</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">int</span> state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Observer</span><span class="token punctuation">></span></span> observers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        observers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        observers<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Observer</span> observer <span class="token operator">:</span> observers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">int</span> state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 状态变化时通知观察者</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">// Observer（观察者）</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token comment">// ConcreteObserver（具体观察者）</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ConcreteObserver</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">ConcreteObserver</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">" received update. New state: "</span> <span class="token operator">+</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token comment">// 客户端使用</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token class-name">ConcreteSubject</span> subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token class-name">ConcreteObserver</span> observer1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteObserver</span><span class="token punctuation">(</span><span class="token string">"Observer 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token class-name">ConcreteObserver</span> observer2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteObserver</span><span class="token punctuation">(</span><span class="token string">"Observer 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>        subject<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>observer1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        subject<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>observer2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre>        subject<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 观察者将收到通知并更新</span></pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="优缺点-6"><a class="anchor" href="#优缺点-6">#</a> 优缺点</h2><p>优点：</p><ol><li>** 解耦性强：** 将目标和观察者解耦，使得它们可以独立变化，增加了系统的灵活性。</li><li>** 扩展性好：** 可以轻松地添加、删除观察者，使系统更容易扩展。</li><li><strong>支持广播通信：</strong><font color="red">目标状态变化时，所有观察者都能收到通知，实现了一对多的通信机制</font>。</li></ol><p>缺点：</p><ol><li>** 可能导致性能问题：** 如果<font color="red">通知过于频繁 / 通知链路过长</font>，可能会导致性能问题。因此，需要仔细设计，避免不必要的通知。</li><li>** 可能引起循环依赖：** 在设计中要<font color="red">注意避免循环依赖，以免触发无限循环的通知</font>。</li></ol><h2 id="应用场景-6"><a class="anchor" href="#应用场景-6">#</a> 应用场景</h2><p>在支付场景下，用户购买一件商品，当支付成功之后会回调自身，在这个时候系统可能会有很多需要执行的观察者逻辑（如：更新订单状态，发送邮件通知，赠送礼品...)，<font color="red">这些逻辑之间并没有强耦合</font>，因此天然适合使用观察者模式去实现这些功能。<font color="red">当有更多的操作时，只需要添加新的观察者</font>，完美实现了对修改关闭，对扩展开放的<font color="red">开闭原则</font>。</p><h1 id="责任链模式"><a class="anchor" href="#责任链模式">#</a> 责任链模式</h1><h2 id="定义-5"><a class="anchor" href="#定义-5">#</a> 定义</h2><p>责任链模式是一种<font color="gree">行为型</font>设计模式，<strong><font color="red">对于一个请求，允许创建一条对象链，上面的每个对象都包含处理该请求的一部分逻辑，并且该请求会沿着链传递，直到某个对象处理它为止</font></strong>。这样就可以动态地组织对象链，而不需要改变其内部结构。此外，<font color="red">一个请求可以被多个对象处理</font>。</p><p>责任链模式<font color="red">非常简单、异常好理解</font>，相信我它比单例模式还简单易懂，其应用也几乎无所不在，甚至可以这么说，从你敲代码的第一天起你就不知不觉用过了<font color="red">它最原始的裸体结构︰ <code>switch-case</code> 语句</font>。</p><p>主要角色：</p><ol><li><strong>处理者（Handler）：</strong> 一个处理请求的接口，通常包含一个处理请求的方法。具体的处理者实现该接口，负责处理请求，也可以把请求传递给链中的下一个处理者。</li><li><strong>具体处理者（ConcreteHandler）：</strong> 实现处理者接口，<font color="red">负责处理特定类型的请求</font>。如果它不能处理请求，<font color="red">可以将请求传递给链中的下一个处理者</font>。</li><li><strong>客户端（Client）：</strong> 创建请求并将其发送到链的第一个处理者。</li></ol><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/v2-698e8b8411b1aee53aef8ee401eff9c3_b.jpg" alt="img"></p><p>让我们以一个报销审批的场景为例，其中有一系列处理者，每个处理者负责审批不同金额范围的报销请求。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 处理者接口</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Approver</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">Expense</span> expense<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 具体处理者</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">implements</span> <span class="token class-name">Approver</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">double</span> <span class="token constant">MAX_APPROVAL_AMOUNT</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Approver</span> nextApprover<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNextApprover</span><span class="token punctuation">(</span><span class="token class-name">Approver</span> nextApprover<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>nextApprover <span class="token operator">=</span> nextApprover<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">Expense</span> expense<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>expense<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token constant">MAX_APPROVAL_AMOUNT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Manager approves the expense request of $"</span> <span class="token operator">+</span> expense<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nextApprover <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            nextApprover<span class="token punctuation">.</span><span class="token function">processRequest</span><span class="token punctuation">(</span>expense<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Director</span> <span class="token keyword">implements</span> <span class="token class-name">Approver</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">double</span> <span class="token constant">MAX_APPROVAL_AMOUNT</span> <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Approver</span> nextApprover<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNextApprover</span><span class="token punctuation">(</span><span class="token class-name">Approver</span> nextApprover<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>nextApprover <span class="token operator">=</span> nextApprover<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">Expense</span> expense<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>expense<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token constant">MAX_APPROVAL_AMOUNT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Director approves the expense request of $"</span> <span class="token operator">+</span> expense<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nextApprover <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            nextApprover<span class="token punctuation">.</span><span class="token function">processRequest</span><span class="token punctuation">(</span>expense<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">VicePresident</span> <span class="token keyword">implements</span> <span class="token class-name">Approver</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">double</span> <span class="token constant">MAX_APPROVAL_AMOUNT</span> <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Approver</span> nextApprover<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNextApprover</span><span class="token punctuation">(</span><span class="token class-name">Approver</span> nextApprover<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>nextApprover <span class="token operator">=</span> nextApprover<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">Expense</span> expense<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>expense<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token constant">MAX_APPROVAL_AMOUNT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Vice President approves the expense request of $"</span> <span class="token operator">+</span> expense<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nextApprover <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            nextApprover<span class="token punctuation">.</span><span class="token function">processRequest</span><span class="token punctuation">(</span>expense<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">President</span> <span class="token keyword">implements</span> <span class="token class-name">Approver</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">double</span> <span class="token constant">MAX_APPROVAL_AMOUNT</span> <span class="token operator">=</span> <span class="token number">50000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">Expense</span> expense<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>expense<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token constant">MAX_APPROVAL_AMOUNT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"President approves the expense request of $"</span> <span class="token operator">+</span> expense<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Expense request of $"</span> <span class="token operator">+</span> expense<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" is rejected."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token comment">// 报销请求类</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Expense</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">double</span> amount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Expense</span><span class="token punctuation">(</span><span class="token keyword">double</span> amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>amount <span class="token operator">=</span> amount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        <span class="token keyword">return</span> amount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="85"></td><td><pre></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token comment">// 客户端使用</span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token comment">// 创建处理者</span></pre></td></tr><tr><td data-num="90"></td><td><pre>        <span class="token class-name">Approver</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>        <span class="token class-name">Approver</span> director <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Director</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token class-name">Approver</span> vicePresident <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VicePresident</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>        <span class="token class-name">Approver</span> president <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">President</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre>        <span class="token comment">// 设置处理链</span></pre></td></tr><tr><td data-num="96"></td><td><pre>        manager<span class="token punctuation">.</span><span class="token function">setNextApprover</span><span class="token punctuation">(</span>director<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>        director<span class="token punctuation">.</span><span class="token function">setNextApprover</span><span class="token punctuation">(</span>vicePresident<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>        vicePresident<span class="token punctuation">.</span><span class="token function">setNextApprover</span><span class="token punctuation">(</span>president<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre></pre></td></tr><tr><td data-num="100"></td><td><pre>        <span class="token comment">// 创建报销请求</span></pre></td></tr><tr><td data-num="101"></td><td><pre>        <span class="token class-name">Expense</span> expense1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Expense</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token class-name">Expense</span> expense2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Expense</span><span class="token punctuation">(</span><span class="token number">2500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>        <span class="token class-name">Expense</span> expense3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Expense</span><span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>        <span class="token class-name">Expense</span> expense4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Expense</span><span class="token punctuation">(</span><span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre>        <span class="token comment">// 提交报销请求</span></pre></td></tr><tr><td data-num="107"></td><td><pre>        manager<span class="token punctuation">.</span><span class="token function">processRequest</span><span class="token punctuation">(</span>expense1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>        manager<span class="token punctuation">.</span><span class="token function">processRequest</span><span class="token punctuation">(</span>expense2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>        manager<span class="token punctuation">.</span><span class="token function">processRequest</span><span class="token punctuation">(</span>expense3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>        manager<span class="token punctuation">.</span><span class="token function">processRequest</span><span class="token punctuation">(</span>expense4<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="优缺点-7"><a class="anchor" href="#优缺点-7">#</a> 优缺点</h2><p>优点：</p><ol><li><strong>解耦责任链的发送者和接收者：</strong> 发送者无需知道具体的处理者，而处理者也无需知道请求的发送者，解耦了系统的组件。</li><li>** 可动态调整责任链：** 可以灵活地增加、删除或调整责任链中的处理者，而不影响其他部分的代码。</li><li>** 符合开闭原则：** 可以通过增加新的处理者来扩展系统，而无需修改现有代码。</li></ol><p>缺点：</p><ol><li><strong>请求可能无法得到处理：</strong> 如果责任链没有得到妥善设计，可能会出现<font color="red">请求无法被处理</font>的情况，或者因为<font color="red">责任链太长而导致性能问题</font>。</li></ol><h2 id="应用场景-7"><a class="anchor" href="#应用场景-7">#</a> 应用场景</h2><ul><li><p><font color="red">当程序需要使用不同方式处理不同种类请求，而且请求类型和顺序预先未知时</font>，可以使用责任链模式。该模式能将多个处理者连接成一条链。接收到请求后，它会 “询问” 每个处理者是否能够对其进行处理。这样所有处理者都有机会来处理请求。</p></li><li><p><font color="red">当必须按顺序执行多个处理者时</font>，可以使用该模式。无论你以何种顺序将处理者连接成一条链，所有请求都会严格按照顺序通过链上的处理者。</p></li></ul><h1 id="策略模式"><a class="anchor" href="#策略模式">#</a> 策略模式</h1><h2 id="定义-6"><a class="anchor" href="#定义-6">#</a> 定义</h2><p>策略模式是一种<font color="gree">行为型</font>设计模式，其用意是 **<font color="red">针对一组算法，将每一个算法封装到具有共同接口的独立的类中，从而使得它们可以相互替换</font>**。策略模式<font color="red">使得算法可以在不影响到客户端的情况下发生变化</font>。其主要目的是通过定义相似的算法，替换 if else 语句写法，并且可以随时相互替换。</p><p>主要角色：</p><ol><li><strong>策略接口（Strategy）：</strong> 一个通用策略接口</li><li><strong>具体策略类（ConcreteStrategy）：</strong> 实现了策略接口，包含了具体的算法实现。</li><li><strong>上下文类（Context）：</strong> 持有一个策略接口的对象引用，用于调用具体的策略。客户端通过上下文类来使用策略。</li></ol><p>代码实现：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 策略接口</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">DiscountStrategy</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">double</span> <span class="token function">applyDiscount</span><span class="token punctuation">(</span><span class="token keyword">double</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 具体策略类 - 无折扣</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">NoDiscountStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">DiscountStrategy</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">applyDiscount</span><span class="token punctuation">(</span><span class="token keyword">double</span> amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> amount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// 具体策略类 - 打九折</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TenPercentDiscountStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">DiscountStrategy</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">applyDiscount</span><span class="token punctuation">(</span><span class="token keyword">double</span> amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">return</span> amount <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">// 具体策略类 - 满减</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">CashBackDiscountStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">DiscountStrategy</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">double</span> threshold<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">double</span> cashBack<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">CashBackDiscountStrategy</span><span class="token punctuation">(</span><span class="token keyword">double</span> threshold<span class="token punctuation">,</span> <span class="token keyword">double</span> cashBack<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>threshold <span class="token operator">=</span> threshold<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>cashBack <span class="token operator">=</span> cashBack<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">applyDiscount</span><span class="token punctuation">(</span><span class="token keyword">double</span> amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">return</span> amount <span class="token operator">>=</span> threshold <span class="token operator">?</span> amount <span class="token operator">-</span> cashBack <span class="token operator">:</span> amount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">// 上下文类</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ShoppingCart</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">DiscountStrategy</span> discountStrategy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDiscountStrategy</span><span class="token punctuation">(</span><span class="token class-name">DiscountStrategy</span> discountStrategy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>discountStrategy <span class="token operator">=</span> discountStrategy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token keyword">double</span> amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">return</span> discountStrategy<span class="token punctuation">.</span><span class="token function">applyDiscount</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token comment">// 客户端使用</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token comment">// 定义上下文类的对象</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token class-name">ShoppingCart</span> cart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShoppingCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token comment">// 选择无折扣策略</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        cart<span class="token punctuation">.</span><span class="token function">setDiscountStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NoDiscountStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">double</span> amount1 <span class="token operator">=</span> cart<span class="token punctuation">.</span><span class="token function">checkout</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Total after no discount: $"</span> <span class="token operator">+</span> amount1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token comment">// 选择打九折策略</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        cart<span class="token punctuation">.</span><span class="token function">setDiscountStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TenPercentDiscountStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token keyword">double</span> amount2 <span class="token operator">=</span> cart<span class="token punctuation">.</span><span class="token function">checkout</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Total after 10% discount: $"</span> <span class="token operator">+</span> amount2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token comment">// 选择满减策略</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        cart<span class="token punctuation">.</span><span class="token function">setDiscountStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CashBackDiscountStrategy</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token keyword">double</span> amount3 <span class="token operator">=</span> cart<span class="token punctuation">.</span><span class="token function">checkout</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Total after cashback discount: $"</span> <span class="token operator">+</span> amount3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="优缺点-8"><a class="anchor" href="#优缺点-8">#</a> 优缺点</h2><p>优点：</p><ol><li>** 算法独立性：** 策略模式使得算法独立于客户端使用而变化，客户端可以灵活地选择策略，甚至在运行时动态切换。</li><li>** 易于扩展：** 新的策略可以很容易地添加到系统中，扩展性好。</li><li>** 避免条件语句：** 使用策略模式可以避免大量的条件语句，提高代码可读性和可维护性。</li></ol><p>缺点：</p><ol><li><strong>类数量增加：</strong><font color="red">每个具体策略都需要一个独立的类</font>，可能会导致类的数量增加，增加系统复杂性。</li></ol><h2 id="应用场景好处"><a class="anchor" href="#应用场景好处">#</a> 应用场景（好处）</h2><ol><li><strong>算法经常变化：</strong> 当系统中的算法经常发生变化，并且客户端需要灵活地选择不同算法的时候，策略模式就可以发挥作用。例如，不同的排序算法、不同的数据压缩算法等。</li><li><strong>需要在运行时动态选择算法：</strong> 如果需要在运行时根据不同的情况选择不同的算法，而且希望将算法的使用与算法的实现解耦，策略模式是一个很好的选择。</li><li><strong>避免使用条件语句：</strong> 当一个类有多个相关的条件语句，并且这些条件语句在不同的场景下产生不同的行为，可以考虑使用策略模式。这样可以避免大量的条件语句，提高代码的可维护性。</li><li><strong>需要一系列相关的算法：</strong> 如果一个系统中有一系列相似的算法，可以将每个算法封装成一个策略类，通过策略模式来管理和调用这些算法，提高代码的可读性和可维护性。</li><li><strong>算法具有复杂性：</strong> 当某个算法的实现比较复杂，且包含许多条件语句和分支时，使用策略模式可以将算法的实现拆分成多个策略类，使代码更加清晰和可理解。</li></ol><p>举例来说，一个电商系统中的<font color="red">购物车结算功能</font>就是一个常见的应用场景。不同的用户或不同的时期可能享受不同的优惠策略，这时可以使用策略模式来管理这些<font color="red">优惠策略</font>，客户端可以根据用户或时期的不同来选择合适的策略进行结算。</p><p>举例： <code>Java.util.List</code> 定义了一个增（add) 、删（remove) 、改 (set) 、查（indexOf）策略，至于实现了这个策略的 <code>ArrayList</code> 、 <code>LinkedList</code> 等不同类，<font color="red">它们只是在具体实现时采用了不同的算法，但是策略是一样的</font>，不考虑速度的情况下，使用时完全可以互相替换使用。</p><h1 id="spring-中涉及的设计模式"><a class="anchor" href="#spring-中涉及的设计模式">#</a> Spring 中涉及的设计模式</h1><ul><li><strong>工厂设计模式</strong> : Spring 使用工厂模式通过 <code>BeanFactory</code> 、 <code>ApplicationContext</code> 创建 bean 对象。</li><li><strong>单例设计模式</strong> : Spring 中的 Bean 默认都是单例的。</li><li><strong>代理设计模式</strong> : Spring AOP 功能的实现。</li><li><strong>模板方法模式</strong> : Spring 中 <code>jdbcTemplate</code> 、 <code>hibernateTemplate</code> 等以 Template 结尾的对数据库操作的类，它们就使用到了模板模式。</li><li><strong>观察者模式:</strong> Spring 事件驱动模型就是观察者模式很经典的一个应用。</li><li><strong>适配器模式</strong> :Spring AOP 的增强或通知 (Advice) 使用到了适配器模式、spring MVC 中也是用到了适配器模式适配 <code>Controller</code> 。</li><li><strong>装饰器设计模式</strong>：我们的项目需要连接多个数据库，而且不同的客户在每次访问中根据需要会去访问不同的数据库。这种模式让我们可以根据客户的需求能够动态切换不同的数据源。</li><li>……</li></ul><h2 id="控制反转ioc"><a class="anchor" href="#控制反转ioc">#</a> 控制反转（IoC）</h2><p>**<font color="#B32015">IoC（Inversion of Control，控制反转）</font>** 是 Spring 中一个非常重要的概念，它是<font color="red">一种解耦的设计思想，有多种实现方式</font>，其核心思想是：</p><ul><li>将 **<font color="cornflowerblue">对象的创建权</font>** 交给第三方容器</li><li>将 **<font color="cornflowerblue">对象之间关系的管理维护权</font>** 交给第三方容器</li></ul><blockquote><p>第三方容器指的是 <font color="red">Spring 中的 IoC 容器</font>，它能管理对象，从而解耦具有依赖关系的对象，开发人员只管使用 IoC 容器即可，降低了代码之间的耦合度。</p><p>Spring IoC = XML 解析 + 工厂模式 + 反射机制</p></blockquote><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240311164331487.png" alt="image-20240311164331487"></p><p>IoC 可以认为是<font color="red">一种全新的设计模式</font>，但是理论和时间成熟相对较晚，并没有包含在 GoF 的 23 种设计模式中。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240310193136124.png" alt="image-20240310193136124"></p><center>IoC 以及各种实现方式</center><p><font color="red"><strong>类似于工厂设计模式</strong>，Spring IoC 容器就像是一个工厂，当我们需要创建对象时，只需配置好配置文件 / 注解即可，完全不用考虑对象是如何被创建出来的。<strong>IoC 容器负责创建对象，将对象连接在一起</strong>，配置这些对象，并从创建中处理这些对象的整个生命周期，直到它们被完全销毁</font>。</p><p>在实际项目中一个 Service 类如果有几百甚至上千个类作为它的底层，我们需要实例化这个 Service，你可能要每次都要搞清这个 Service 所有底层类的构造函数，这可能会把人逼疯。如果利用 IOC 的话，你只需要配置好，然后在需要的地方引用就行了，<font color="red">这大大增加了项目的可维护性，且降低了开发难度</font>。</p><blockquote><p>关于 Spring IOC 的理解，推荐看这一下知乎的一个回答：<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzIzMjc3NTc1L2Fuc3dlci8xNjk2OTg2NjI=">https://www.zhihu.com/question/23277575/answer/169698662open in new window</span> ，非常不错。</p></blockquote><p>通俗理解：控制反转（IoC）就像是一家餐馆，你在餐馆里吃饭时，不需要亲自去厨房做菜，而是把控制权（决定菜单、烹饪方式等）交给了餐馆。在编程中，IoC 是一种思想，你不再需要自己去创建和管理对象，而是把这个任务交给了框架或容器。在 Spring 中，IoC 意味着 **<font color="red">你不用自己负责 Bean（对象）的创建和管理，而是把这些任务交给了 Spring 容器</font>**。</p><p>举个例子：&quot; 对象 a 依赖了对象 b，当对象 a 需要使用对象 b 的时候必须自己去创建。但是<font color="red">当系统引入了 IOC 容器后， 对象 a 和对象 b 之间就失去了直接的联系</font>。这个时候，当对象 a 需要使用 对象 b 的时候，<font color="red">可以指定 IOC 容器去创建一个对象 b 注入到对象 a 中</font>&quot;。对于对象 a 获得依赖对象 b 的过程，由主动行为变为了被动行为，控制权反转，这就是控制反转名字的由来。</p><h2 id="依赖注入di"><a class="anchor" href="#依赖注入di">#</a> 依赖注入（DI）</h2><p>前文提到的 IoC 是一种思想，有多种实现方式，其中最常见的实现方式就是 **<font color="#B32015">DI（Dependency Inject，依赖注入）</font>**，就是<font color="red">将实例变量传入到一个对象中去</font>。</p><ul><li>依赖：A 对象和 B 对象的关系。</li><li>注入：是一种手段，通过这种手段，可以让 A 对象和 B 对象产生关系。</li><li>依赖注入：对象 A 和对象 B 之间的关系，靠注入的手段来维护。</li></ul><p>依赖注入包括两种方式：</p><ul><li><font color="cornflowerblue">set 注入</font>：发生在对象实例化后，通过<font color="red">反射机制</font>调用 <font color="red">set 方法 </font>来给属性赋值，让两个对象之间产生关系。</li><li><font color="cornflowerblue">构造注入</font>：发生在对象实例化中，通过调用 <font color="red">构造方法</font> 来给属性赋值。</li></ul><p>通俗理解：依赖注入就像是餐馆把菜单上的菜送到你面前，而不是你去主动取。在编程中，DI 是一种实现 IoC 的方式，它让框架或容器负责将需要的对象传递给你的代码，而不是你去创建或查找这些对象。在 Spring 中，DI 意味着 **<font color="red">你不需要亲自创建对象的实例，而是通过配置或注解告诉 Spring IoC 容器，框架将会在需要的时候将对象注入到你的代码中</font>**。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240312150320154.png" alt="image-20240312150320154"></p><h2 id="简单工厂"><a class="anchor" href="#简单工厂">#</a> 简单工厂</h2><p>Spring 的 <code>BeanFactory</code> 接口是 IOC 容器的顶级接口，<font color="red">充当 Bean 工厂</font>，根据指定的类名或 ID 创建 Bean 实例。</p><h2 id="工厂方法"><a class="anchor" href="#工厂方法">#</a> 工厂方法</h2><p>Spring 的 <code>FactoryBean</code> 接口允许开发人员在 Spring 容器中注册<font color="red">一个自定义的 Bean 工厂，自定义 Bean 的创建逻辑</font>，然后在配置文件中配置该工厂，Spring 容器将使用该工厂创建 Bean 实例。</p><h2 id="工厂设计模式"><a class="anchor" href="#工厂设计模式">#</a> 工厂设计模式</h2><p>前文有介绍<a href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">工厂设计模式</a>。</p><p>Spring 使用<font color="red">工厂模式</font>可以通过<font color="gree"> <code>BeanFactory</code> 接口或 <code>ApplicationContext</code> 接口</font>创建 bean 对象。</p><ul><li><code>BeanFactory</code> 接口：<ul><li>是 IOC 容器的<font color="red">顶级接口</font></li><li>能够产生 Bean 对象的一个工厂对象</li><li><strong><font color="red">延迟注入</font></strong>(使用到某个 bean 的时候才会注入)</li><li>相比于 <code>ApplicationContext</code> 来说会<font color="red">占用更少的内存</font>，程序启动速度更快</li></ul></li><li><code>ApplicationContext</code> 接口：<ul><li><strong><font color="red">容器启动时一次性创建所有 bean</font></strong>，不管你用没用到</li><li><code>BeanFactory</code> 仅提供了最基本的依赖注入支持， <code>ApplicationContext</code> 继承扩展了 <code>BeanFactory</code> ，所以一般开发人员使用 <code>ApplicationContext</code> 会更多</li></ul></li></ul><p><code>ApplicationContext</code> 接口的三个实现类：</p><ol><li><code>ClassPathXmlApplication</code> ：把上下文文件当成类路径资源。</li><li><code>FileSystemXmlApplication</code> ：从文件系统中的 XML 文件载入上下文定义信息。</li><li><code>XmlWebApplicationContext</code> ：从 Web 系统中的 XML 文件载入上下文定义信息。</li></ol><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240312153233963.png" alt="image-20240312153233963"></p><p>Example:</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">FileSystemXmlApplicationContext</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemXmlApplicationContext</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">"C:/work/IOC Containers/springframework.applicationcontext/src/main/resources/bean-factory-config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token class-name">HelloApplicationContext</span> obj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HelloApplicationContext</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"helloApplicationContext"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    obj<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="单例设计模式"><a class="anchor" href="#单例设计模式">#</a> 单例设计模式</h2><p>前文有介绍<a href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">单例设计模式</a>。</p><p>**<font color="red">Spring 中<font color="gree"> bean 实例</font>的默认作用域就是 singleton (单例) 的，确保在容器中只有一个共享的实例，在创建上下文的时候初始化。</font>** 此外，Spring 中 bean 还有下面几种作用域：</p><ul><li><strong>prototype（原型）</strong> : <font color="red">每调用一次 getBean () 都会创建一个新的 bean 实例</font>。也就是说，连续 <code>getBean()</code> 两次，得到的是不同的 Bean 实例。</li><li><strong>request</strong> （仅 Web 应用可用）: <font color="red">每一次 HTTP 请求都会产生一个新的 bean（请求 bean）</font>，该 bean 仅在当前 HTTP request 内有效。</li><li><strong>session</strong> （仅 Web 应用可用） :<font color="red"> 每一次来自新 session 的 HTTP 请求都会产生一个新的 bean（会话 bean）</font>，该 bean 仅在当前 HTTP session 内有效。</li><li><strong>application/global-session</strong> （仅 Web 应用可用）：每个 Web 应用<font color="red">在启动时创建一个 Bean（应用 Bean）</font>，该 bean 仅在当前应用启动时间内有效。</li><li><strong>websocket</strong> （仅 Web 应用可用）：<font color="red">每一次 WebSocket 会话产生一个新的 bean</font>。</li></ul><p><strong><font color="gree">Spring 通过 <code>ConcurrentHashMap</code> 实现单例注册表</font></strong>，核心代码如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 通过 ConcurrentHashMap（线程安全） 实现单例注册表</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> singletonFactory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token string">"'beanName' must not be null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token comment">// 检查缓存中是否存在实例</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token class-name">Object</span> singletonObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token comment">//... 省略了很多代码</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                    singletonObject <span class="token operator">=</span> singletonFactory<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token comment">//... 省略了很多代码</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token comment">// 如果实例对象在不存在，我们注册到单例注册表中。</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token function">addSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonObject<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token keyword">return</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">!=</span> <span class="token constant">NULL_OBJECT</span> <span class="token operator">?</span> singletonObject <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// 将对象添加到单例注册表</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> singletonObject<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                <span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> singletonObject <span class="token operator">:</span> <span class="token constant">NULL_OBJECT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>单例 Bean 存在线程安全问题吗？</p><p>大部分时候我们并没有在项目中使用多线程，所以很少有人会关注这个问题。<font color="red">单例 Bean 存在线程问题，主要是因为当多个线程操作同一个对象的时候是存在资源竞争的</font>。常见的有两种解决办法：</p><ol><li>在 Bean 中尽量避免定义可变的成员变量。</li><li>在类中定义一个 <code>ThreadLocal</code> 成员变量，将需要的可变成员变量保存在 <code>ThreadLocal</code> 中（推荐的一种方式）。</li></ol><p>不过，大部分 Bean 实际都是无状态（没有实例变量）的（比如 Dao、Service），这种情况下， Bean 是线程安全的。</p><h2 id="代理设计模式"><a class="anchor" href="#代理设计模式">#</a> 代理设计模式</h2><p>前文有介绍<a href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F">代理设计模式</a>。</p><h3 id="面向切面编程aop"><a class="anchor" href="#面向切面编程aop">#</a> 面向切面编程（AOP）</h3><blockquote><p>动态代理</p></blockquote><p>**<font color="gree">AOP（Aspect-Oriented Programming，面向切面编程）</font>** 是一种<font color="red">“模块组件”</font>的编程思想，是对 OOP 的延伸。其中，<font color="cornflowerblue">切面指的是那些与核心业务逻辑无关的通用逻辑代码，专业术语为 “交叉业务”</font>，例如日志管理、安全模块、事务处理和权限控制等。<font color="red">AOP 将与核心业务无关的代码独立的抽取出来，形成一个独立的组件 (切面)，然后以横向交叉的方式应用到业务流程当中</font>。如下图所示，纵向的是业务逻辑，横向的是交叉业务。通过将交叉业务封装为切面，便于减少系统的重复代码，降低模块间的耦合度，并有利于未来的可拓展性和可维护性。</p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240312174811414.png" alt="image-20240312174811414" style="zoom:67%"><p><font color="red"><strong>Spring AOP 的底层实现是：JDK 动态代理 + CGLIB 动态代理</strong>，Spring 在这两种动态代理中灵活切换，也可以强制通过一些配置让 Spring 只使用 CGLIB 。</font></p><ul><li><font color="cornflowerblue">JDK 动态代理</font>：<font color="red">基于接口</font>。如果目标对象实现了某个接口，那么默认使用 JDK Proxy 去创建代理对象</li><li><font color="cornflowerblue">CGLIB 动态代理</font>：<font color="red">基于父类</font>。如果目标对象没有实现任何接口，就会使用 CGLIB 生成一个被代理对象的子类来作为代理</li></ul><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/20210114223142644.png" alt="在这里插入图片描述"></p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/SpringAOPProcess.jpg" alt="基于动态代理实现 Spring AOP"></p><center>基于动态代理实现 Spring AOP</center><p>当然，也可以使用 <font color="cornflowerblue">AspectJ</font> 来实现 Spring AOP，AspectJ 应该算的上是 Java 生态系统中最完整的 AOP 框架了。</p><p>使用 AOP 之后我们可以把一些通用功能抽象出来，在需要用到的地方直接使用即可，这样大大简化了代码量。我们需要增加新功能时也方便，这样也提高了系统扩展性。日志功能、事务管理等场景都用到了 AOP 。</p><h3 id="spring-aop-和-aspectj-的区别"><a class="anchor" href="#spring-aop-和-aspectj-的区别">#</a> Spring AOP 和 AspectJ 的区别</h3><p><strong>Spring AOP 属于运行时增强，而 AspectJ 是编译时增强。</strong> Spring AOP 基于代理 (Proxying)，而 AspectJ 基于字节码操作 (Bytecode Manipulation)。</p><p>Spring AOP 已经集成了 AspectJ ，AspectJ 应该算的上是 Java 生态系统中最完整的 AOP 框架了。AspectJ 相比于 Spring AOP 功能更加强大，但是 Spring AOP 相对来说更简单。</p><p>如果我们的切面比较少，那么两者性能差异不大。但是，<font color="red">当切面太多的话，最好选择 AspectJ ，它比 Spring AOP 快很多</font>。</p><h2 id="模板方法设计模式"><a class="anchor" href="#模板方法设计模式">#</a> 模板方法设计模式</h2><p>模板方法设计模式是一种行为型设计模式，<font color="red">它定义一个操作中的算法的骨架，而将一些步骤延迟到子类中</font>。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤的实现方式。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Template</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 这是我们的模板方法</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token class-name">TemplateMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">PrimitiveOperation1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">PrimitiveOperation2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">PrimitiveOperation3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">void</span>  <span class="token class-name">PrimitiveOperation1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token comment">// 当前类实现</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 被子类实现的方法</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token class-name">PrimitiveOperation2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token class-name">PrimitiveOperation3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateImpl</span> <span class="token keyword">extends</span> <span class="token class-name">Template</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">PrimitiveOperation2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment">// 当前类实现</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">PrimitiveOperation3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token comment">// 当前类实现</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>Spring 的许多模块和外部扩展都采用模板方法设计模式，例如 <strong><font color="gree"><code>JdbcTemplate</code> 、 <code>HibernateTemplate</code> 等以 Template 结尾的对数据库操作的类，它们就使用到了模板模式</font></strong>。一般情况下，我们都是使用继承的方式来实现模板模式，但是 Spring 并没有使用这种方式，而是<font color="red">使用 Callback 模式与模板方法模式配合</font>，既达到了代码复用的效果，同时增加了灵活性。</p><p>在 Spring 中，<font color="gree"> <code>JdbcTemplate</code> 和 <code>HibernateTemplate</code> 都是用于简化数据库访问的模板类</font>。它们通过模板方法设计模式<font color="red">提供了一种标准的方式来执行数据库操作，同时隐藏了底层数据库访问的细节</font>，使得开发者能够专注于业务逻辑的实现而不必关注底层数据库操作的细节。</p><p>模板方法设计模式的核心思想是定义一个算法的骨架，将算法的一些步骤延迟到子类中实现。在 <code>JdbcTemplate</code> 和 <code>HibernateTemplate</code> 中，<strong><font color="red">这个算法的骨架就是数据库访问的过程，而延迟到子类中实现的部分则是具体的数据库操作</font></strong>。</p><p>下面简要介绍一下两者如何体现模板方法设计模式：</p><ol><li><p><strong>JdbcTemplate</strong>：<br><code>JdbcTemplate</code> 是 Spring 提供的用于执行 SQL 查询、更新等操作的模板类。它封装了 JDBC 的调用，简化了 JDBC 的使用。<font color="red"> <code>JdbcTemplate</code> 中的模板方法就是 <code>execute()</code> 方法，通过该方法可以执行任意 SQL 查询或更新操作，而具体的 SQL 语句和参数则由用户提供</font>。例如：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>jdbcTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>connection <span class="token operator">-></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM users WHERE username = ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"john_doe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 处理结果集</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在这个例子中，<font color="red"> <code>execute()</code> 方法就是模板方法，它提供了数据库连接的获取、SQL 语句的执行等步骤的骨架，而具体的 SQL 查询逻辑则由用户提供</font>。</p></li><li><p><strong>HibernateTemplate</strong>：<br><code>HibernateTemplate</code> 是 Spring 对 Hibernate 框架的封装，提供了一种简化 Hibernate 操作的方式。在 <code>HibernateTemplate</code> 中，模板方法就是 <code>execute()</code> 方法，它用于执行 Hibernate 操作，比如加载、保存、更新、删除对象等。例如：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>hibernateTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>session <span class="token operator">-></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">User</span> user <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 修改用户信息</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    session<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在这个例子中， <code>execute()</code> 方法提供了 Hibernate 操作的骨架，包括获取 Hibernate Session、执行操作、事务管理等，而具体的业务逻辑则由用户提供。</p></li></ol><p>通过模板方法设计模式， <code>JdbcTemplate</code> 和 <code>HibernateTemplate</code> 封装了底层的数据库操作细节，提供了一种统一的、标准的方式来执行数据库操作，使得代码更加简洁、易读，并且降低了开发者使用底层框架的学习成本。</p><h2 id="观察者设计模式"><a class="anchor" href="#观察者设计模式">#</a> 观察者设计模式</h2><p>前文有介绍<a href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F">观察者模式</a>。</p><p>观察者模式是一种对象行为型模式。它表示的是<font color="red">对象与对象之间具有一对多依赖关系，当一个对象发生改变的时候，依赖这个对象的所有对象也会做出反应</font>。</p><p><font color="red">**<font color="gree">Spring 事件监听机制</font>** 允许组件监听和响应特定类型的事件，实现了松耦合的组件通信</font>，就是观察者模式很经典的一个应用。在很多场景都可以解耦我们的代码。比如我们每次添加商品的时候都需要重新更新商品索引，这个时候就可以利用观察者模式来解决这个问题。</p><h3 id="spring-事件监听机制的三种角色"><a class="anchor" href="#spring-事件监听机制的三种角色">#</a> Spring 事件监听机制的三种角色</h3><h4 id="事件"><a class="anchor" href="#事件">#</a> 事件</h4><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/20171118223102623" alt="img"></p><p><code>ApplicationEvent</code> ( <code>org.springframework.context</code> 包下）充当事件的角色，这是一个抽象类，它继承了 <code>java.util.EventObject</code> 并实现了 <code>java.io.Serializable</code> 接口。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationEvent</span> <span class="token keyword">extends</span> <span class="token class-name">EventObject</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token comment">/** use serialVersionUID from Spring 1.2 for interoperability */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">7099057708183571937L</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token comment">/** System time when the event happened */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">long</span> timestamp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token keyword">public</span> <span class="token class-name">ApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span>timestamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>   <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>Spring 中默认存在以下事件，他们都是对 <code>ApplicationContextEvent</code> 的实现 (继承自 <code>ApplicationContextEvent</code> )：</p><ul><li><code>ContextStartedEvent</code> ： <code>ApplicationContext</code> 启动后触发的事件；</li><li><code>ContextStoppedEvent</code> ： <code>ApplicationContext</code> 停止后触发的事件；</li><li><code>ContextRefreshedEvent</code> ： <code>ApplicationContext</code> 初始化或刷新完成后触发的事件；</li><li><code>ContextClosedEvent</code> ： <code>ApplicationContext</code> 关闭后触发的事件。</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextEvent</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationEvent</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token keyword">public</span> <span class="token class-name">ApplicationContextEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ApplicationContext</span> <span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span><span class="token punctuation">)</span> <span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="事件监听者"><a class="anchor" href="#事件监听者">#</a> 事件监听者</h4><p><code>ApplicationListener</code> 接口充当了事件监听者角色，里面只定义了一个 <code>onApplicationEvent（）</code> 方法来处理 <code>ApplicationEvent</code> 。源码如下，可以看出接口中的事件只要继承了 <code>ApplicationEvent</code> 就可以了。所以，在 Spring 中我们只要实现 <code>ApplicationListener</code> 接口的 <code>onApplicationEvent()</code> 方法即可完成监听事件。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">EventListener</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token annotation punctuation">@FunctionalInterface</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationEvent</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">EventListener</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">E</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="事件发布者事件源"><a class="anchor" href="#事件发布者事件源">#</a> 事件发布者（事件源）</h4><p><code>ApplicationEventPublisher</code> 接口充当了事件的发布者，源码如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@FunctionalInterface</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationEventPublisher</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>其中的 <code>publishEvent（）</code> 这个方法在 <code>AbstractApplicationContext</code> 类中被实现，阅读这个方法的实现，你会发现实际上事件真正是通过 <code>ApplicationEventMulticaster</code> 来广播出去的。具体内容过多，就不在这里分析了。</p><h3 id="spring-的事件流程小结"><a class="anchor" href="#spring-的事件流程小结">#</a> Spring 的事件流程小结</h3><ol><li><p>定义一个事件：实现一个继承自 <code>ApplicationEvent</code> 的类，并且写相应的构造函数；</p></li><li><p>定义一个事件监听者：实现 <code>ApplicationListener</code> 接口，重写 <code>onApplicationEvent()</code> 方法；</p></li><li><p>使用事件发布者发布消息：可以通过 <code>ApplicationEventPublisher</code> 的 <code>publishEvent()</code> 方法发布消息。</p></li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 定义一个事件，继承自 ApplicationEvent 并且写相应的构造函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoEvent</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationEvent</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">DemoEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">,</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> message<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 定义一个事件监听者，实现 ApplicationListener 接口，重写 onApplicationEvent () 方法；</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoListener</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DemoEvent</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// 使用 onApplicationEvent 接收消息</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">DemoEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">String</span> msg <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"接收到的信息是："</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">// 发布事件，可以通过 ApplicationEventPublisher  的 publishEvent () 方法发布消息。</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoPublisher</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publish</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token comment">// 发布事件</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        applicationContext<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DemoEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>当调用 <code>DemoPublisher</code> 的 <code>publish()</code> 方法的时候，比如 <code>demoPublisher.publish(&quot;你好&quot;)</code> ，控制台就会打印出: <code>接收到的信息是：你好</code> 。</p><h2 id="适配器设计模式"><a class="anchor" href="#适配器设计模式">#</a> 适配器设计模式</h2><p>前文有介绍<a href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F">适配器模式</a>。</p><p>适配器模式 (Adapter Pattern) <font color="red">将一个接口转换成客户希望的另一个接口，使接口不兼容的那些类可以一起工作</font>。</p><h3 id="spring-aop-中"><a class="anchor" href="#spring-aop-中">#</a> Spring AOP 中</h3><p>我们知道 Spring AOP 的实现是基于代理模式，但是 <font color="gree">Spring AOP 的增强或通知（Advice）使用到了适配器模式，与之相关的接口是  <code>AdvisorAdapter</code> </font>。</p><p>通知（Advice）常用的类型有：</p><ul><li><font color="cornflowerblue">前置通知</font>：使用 <code>@Before</code> 注解标识，在被代理的目标方法前执行</li><li><font color="cornflowerblue">返回通知</font>：使用 <code>@AfterReturning</code> 注解标识，在被代理的目标方法<font color="red">成功结束</font>后执行（寿终正寝）</li><li><font color="cornflowerblue">异常通知</font>：使用 <code>@AfterThrowing</code> 注解标识，在被代理的目标方法<font color="red">异常结束</font>后执行（死于非命）</li><li><font color="cornflowerblue">后置通知</font>：使用 <code>@After</code> 注解标识，在被代理的目标方法<font color="red">最终结束</font>后执行（盖棺定论）</li><li><font color="cornflowerblue">环绕通知</font>：使用 <code>@Around</code> 注解标识，使用 try...catch...finally 结构围绕整个被代理的目标方法，包括上面四种通知对应的所有位置</li></ul><p>每个类型 Advice 都有对应的拦截器： <code>MethodBeforeAdviceInterceptor</code> 、 <code>AfterReturningAdviceInterceptor</code> 、 <code>ThrowsAdviceInterceptor</code> 等等。</p><p><font color="red">Spring 预定义的 Advice 要通过对应的适配器，适配成 <code>MethodInterceptor</code> 接口 (方法拦截器) 类型的对象</font>（如： <code>MethodBeforeAdviceAdapter</code> 通过调用 <code>getInterceptor</code> 方法，将 <code>MethodBeforeAdvice</code> 适配成 <code>MethodBeforeAdviceInterceptor</code> ）。</p><h3 id="spring-mvc-中"><a class="anchor" href="#spring-mvc-中">#</a> Spring MVC 中</h3><p>在 Spring MVC 中， <code>DispatcherServlet</code> 根据请求信息调用 <code>HandlerMapping</code> ，解析请求对应的 <code>Handler</code> 。解析到对应的 <code>Handler</code> （也就是我们平常说的 <code>Controller</code> 控制器）后，开始由 <code>HandlerAdapter</code> 适配器处理。<font color="gree"> <code>HandlerAdapter</code> 作为适配器（期望接口），有不同的实现类来处理不同类型的处理器（需要适配的类）</font>。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/image-20240313164642619.png" alt="image-20240313164642619"></p><p>为什么要在 Spring MVC 中使用适配器模式？</p><p><font color="red">Spring MVC 中的 <code>Controller</code> 种类众多，不同类型的 <code>Controller</code> 通过不同的方法来对请求进行处理</font>。如果不利用适配器模式的话， <code>DispatcherServlet</code> 直接获取对应类型的 <code>Controller</code> ，需要自行来判断，像下面这段代码一样：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">MultiActionController</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MultiActionController</span><span class="token punctuation">)</span>mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xxx</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">XXX</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>假如我们再增加一个 <code>Controller</code> 类型就要在上面代码中再加入一行 判断语句，这种形式就使得程序难以维护，也违反了设计模式中的开闭原则 —— 对扩展开放，对修改关闭。</p><h2 id="装饰器设计模式"><a class="anchor" href="#装饰器设计模式">#</a> 装饰器设计模式</h2><p>前文有介绍<a href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F">装饰器模式</a>。</p><p>装饰器模式可以动态地给对象添加一些额外的属性或行为。相比于使用继承，装饰器模式更加灵活。简单点儿说就是<font color="red">当我们需要修改原有的功能，但我们又不愿直接去修改原有的代码时，设计一个 Decorator 套在原有代码外面</font>。</p><p>其实在 JDK 中就有很多地方用到了装饰器模式，比如 <code>InputStream</code> 家族， <code>InputStream</code> 类下有 <code>FileInputStream</code> (读取文件)、 <code>BufferedInputStream</code> (增加缓存，使读取文件速度大大提升) 等子类都在不修改 <code>InputStream</code> 代码的情况下扩展了它的功能。</p><p><img data-src="https://raw.githubusercontent.com/hjx159/picture-bed/main/img/Decorator.jpg" alt="装饰器模式 示意图"></p><center>装饰器模式 示意图</center><p>Spring 中配置 DataSource 的时候，DataSource 可能是不同的数据库和数据源。我们能否根据客户的需求在少修改原有类的代码下动态切换不同的数据源？这个时候就要用到装饰器模式 (这一点我自己还没太理解具体原理)。</p><p>Spring 中用到的包装器模式在类名上含有 <code>Wrapper</code> 或者 <code>Decorator</code> ，这些类基本上都是动态地给一个对象添加一些额外的职责。<font color="gree">例如 <code>BeanWrapper</code> 允许在不修改原始 Bean 类的情况下添加额外的功能</font>。</p><h2 id="策略模式-2"><a class="anchor" href="#策略模式-2">#</a> 策略模式</h2><p>前文有介绍<a href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F">策略模式</a>。</p><p>Spring 允许使用策略模式来定义<font color="gree">包扫描时的过滤策略</font>，例如在 <code>@ComponentScan</code> 注解中使用的 excludeFilters 和 includeFilters 。</p><h2 id="责任链设计模式"><a class="anchor" href="#责任链设计模式">#</a> 责任链设计模式</h2><p>Spring AOP 通过责任链模式实现<font color="gree">通知（Advice）的调用</font>，确保通知按照顺序执行。</p><h1 id="jdk-中涉及的设计模式"><a class="anchor" href="#jdk-中涉及的设计模式">#</a> JDK 中涉及的设计模式</h1><h2 id="桥接模式"><a class="anchor" href="#桥接模式">#</a> 桥接模式</h2><p>这个模式<font color="red">将抽象和对应实现进行解耦，使得二者可以独立地变化</font>。</p><p>GOF 在提出桥梁模式的时候指出，桥梁模式的用意是 “将抽象化 (Abstraction) 与实现化 (Implementation) 脱耦，使得二者可以独立地变化”。这句话有三个关键词，也就是抽象化、实现化和脱耦。</p><p>在 Java 应用中，对于桥接模式有一个非常典型的例子，就是 **<font color="gree">应用程序使用 JDBC 驱动程序进行开发的方式</font>**。所谓驱动程序，指的是<font color="red">按照预先约定好的接口来操作</font>计算机系统或者是外围设备的程序。</p><h2 id="适配器模式-2"><a class="anchor" href="#适配器模式-2">#</a> 适配器模式</h2><p>用来<font color="red">把一个接口转化成另一个接口</font>，使得原本由于接口不兼容而不能一起工作的那些类可以在一起工作。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Arrays</span>#<span class="token function">asList</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>OutputStreamWriter</span><span class="token punctuation">(</span><span class="token class-name">OutputStream</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="组合模式"><a class="anchor" href="#组合模式">#</a> 组合模式</h2><p><font color="red">又叫做部分 - 整体模式，使得客户端看来单个对象和对象的组合是同等的。换句话说，某个类型的方法同时也接受自身类型作为参数。</font></p><pre><code>java.util.Map#putAll(Map)
java.util.List#addAll(Collection)
java.util.Set#addAll(Collection)
</code></pre><h2 id="装饰器模式-2"><a class="anchor" href="#装饰器模式-2">#</a> 装饰器模式</h2><p><font color="red">动态地给一个对象附加额外的功能 / 属性</font>，这也是子类的一种替代方式。可以看到，<font color="red">在创建一个类型的时候，同时也传入同一类型的对象</font>。这在 JDK 里随处可见，你会发现它无处不在，所以下面这个列表只是一小部分。</p><pre><code>java.io.FileInputStream(InputStream)
java.io.BufferedInputStream(InputStream)
java.io.DataInputStream(InputStream)

java.io.BufferedOutputStream(OutputStream)
java.util.zip.ZipOutputStream(OutputStream)

java.util.Collections#checkedList|Map|Set|SortedSet|SortedMap
</code></pre><p>比如 <code>InputStream</code> 类下有 <code>FileInputStream</code> (读取文件)、 <code>BufferedInputStream</code> (增加缓存，使读取文件速度大大提升) 等子类都在不修改 <code>InputStream</code> 代码的情况下扩展了它的功能。</p><h2 id="享元模式"><a class="anchor" href="#享元模式">#</a> 享元模式</h2><p><font color="red">使用缓存来加速大量小对象的访问时间</font>。</p><pre><code>java.lang.Integer#valueOf(int)
java.lang.Boolean#valueOf(boolean)
java.lang.Byte#valueOf(byte)
java.lang.Character#valueOf(char)
</code></pre><h2 id="代理模式-2"><a class="anchor" href="#代理模式-2">#</a> 代理模式</h2><pre><code>java.lang.reflect.Proxy
RMI
</code></pre><h2 id="工厂方法模式-2"><a class="anchor" href="#工厂方法模式-2">#</a> 工厂方法模式</h2><p><font color="red">一个返回具体对象的方法</font>。</p><pre><code>java.lang.Proxy#newProxyInstance()
java.lang.Object#toString()
java.lang.Class#newInstance()
java.lang.reflect.Array#newInstance()
java.lang.reflect.Constructor#newInstance()
java.lang.Boolean#valueOf(String)
java.lang.Class#forName()
</code></pre><h2 id="抽象工厂模式-2"><a class="anchor" href="#抽象工厂模式-2">#</a> 抽象工厂模式</h2><p>抽象工厂模式<font color="red">提供了一个协议来生成一系列的相关或者独立的对象，而不用指定具体对象的类型</font>。它使得应用程序能够和使用的框架的具体实现进行解耦。</p><p>这在 JDK 或者许多框架比如 Spring 中都随处可见。它们也很容易识别，<font color="red">一个创建新对象的方法，返回的却是接口或者抽象类的，就是抽象工厂模式了</font>。</p><pre><code>java.util.Calendar#getInstance()
java.util.Arrays#asList()
java.util.ResourceBundle#getBundle()
java.sql.DriverManager#getConnection()
java.sql.Connection#createStatement()
java.sql.Statement#executeQuery()
java.text.NumberFormat#getInstance()
javax.xml.transform.TransformerFactory#newInstance()
</code></pre><h2 id="建造者模式"><a class="anchor" href="#建造者模式">#</a> 建造者模式</h2><p><font color="red">定义了一个新类来构建另一个类的实例，以简化复杂对象的创建</font>。建造模式通常也使用<font color="red">方法链接</font>来实现。</p><pre><code>java.lang.StringBuilder#append()
java.lang.StringBuffer#append()
java.sql.PreparedStatement
javax.swing.GroupLayout.Group#addComponent(
</code></pre><h2 id="原型模式"><a class="anchor" href="#原型模式">#</a> 原型模式</h2><p><font color="red">如果创建一个实例非常复杂耗时，可以通过复制现有实例来创建新实例</font>。</p><pre><code>java.lang.Object#clone()
java.lang.Cloneable
</code></pre><h2 id="单例模式-2"><a class="anchor" href="#单例模式-2">#</a> 单例模式</h2><p>用来确保类只有一个实例。Joshua Bloch 在 Effetive Java 中建议到，还有一方法就是使用<font color="gree">枚举类</font>。</p><pre><code>java.lang.Runtime#getRuntime()
java.awt.Toolkit#getDefaultToolkit()
java.awt.GraphicsEnvironment#getLocalGraphicsEnvironment()
java.awt.Desktop#getDesktop()
</code></pre><h2 id="责任链模式-2"><a class="anchor" href="#责任链模式-2">#</a> 责任链模式</h2><p>通过<font color="red">把请求从一个对象传递到链条中下一个对象的方式，直到请求被处理完毕</font>，以实现对象间的解耦。</p><pre><code>java.util.logging.Logger#log()
javax.servlet.Filter#doFilter()
</code></pre><h2 id="命令模式"><a class="anchor" href="#命令模式">#</a> 命令模式</h2><p><font color="red">将操作封装到对象内，以便存储，传递和返回</font>。</p><pre><code>java.lang.Runnable
javax.swing.Action
</code></pre><h2 id="解释器模式"><a class="anchor" href="#解释器模式">#</a> 解释器模式</h2><p><font color="red">定义了⼀个语⾔的语法，然后解析相应语法的语句</font>。</p><pre><code>java.util.Pattern
java.text.Normalizer
java.text.Format
</code></pre><h2 id="迭代器模式"><a class="anchor" href="#迭代器模式">#</a> 迭代器模式</h2><p><font color="red">提供一个一致的方法来顺序访问集合中的对象，而该方法与集合的底层具体实现无关</font>。</p><pre><code>java.util.Iterator
java.util.Enumeration
</code></pre><h2 id="中介者模式"><a class="anchor" href="#中介者模式">#</a> 中介者模式</h2><p><font color="red">通过使用一个中间对象来进行消息分发以及减少类之间的直接依赖</font>。</p><pre><code>java.util.Timer
java.util.concurrent.Executor#execute()
java.util.concurrent.ExecutorService#submit()
java.lang.reflect.Method#invoke()
</code></pre><h2 id="备忘录模式"><a class="anchor" href="#备忘录模式">#</a> 备忘录模式</h2><p><font color="red">生成对象状态的一个快照，以便对象可以恢复原始状态而不用暴露自身的内容</font>。Date 对象通过自身内部的一个 long 值来实现备忘录模式。</p><pre><code>java.util.Date
java.io.Serializable
</code></pre><h2 id="空对象模式"><a class="anchor" href="#空对象模式">#</a> 空对象模式</h2><p><font color="red">通过一个无意义的对象来代替没有对象的状态，使得你不需要额外处理空对象</font>。</p><pre><code>java.util.Collections#emptyList()
java.util.Collections#emptyMap()
java.util.Collections#emptySet()
</code></pre><h2 id="观察者模式-2"><a class="anchor" href="#观察者模式-2">#</a> 观察者模式</h2><p><font color="red">使得一个对象可以灵活地将消息发送给感兴趣的对象</font>。</p><pre><code>java.util.EventListener
javax.servlet.http.HttpSessionBindingListener
javax.servlet.http.HttpSessionAttributeListener
javax.faces.event.PhaseListener
</code></pre><h2 id="状态模式"><a class="anchor" href="#状态模式">#</a> 状态模式</h2><p><font color="red">通过改变对象内部的状态，使得可以在运行时动态改变一个对象的行为</font>。</p><pre><code>java.util.Iterator
javax.faces.lifecycle.LifeCycle#execute()
</code></pre><h2 id="策略模式-3"><a class="anchor" href="#策略模式-3">#</a> 策略模式</h2><p><font color="red">将一组算法封装成一系列对象，通过传递这些对象可以灵活的改变程序的功能</font>。</p><pre><code>java.util.Comparator#compare()
javax.servlet.http.HttpServlet
javax.servlet.Filter#doFilter()
</code></pre><h2 id="模板方法模式"><a class="anchor" href="#模板方法模式">#</a> 模板方法模式</h2><p><font color="red">让子类可以重写方法的一部分，而不是整个重写</font>，你可以控制子类需要重写那些操作。</p><pre><code>java.util.Collections#sort()
java.io.InputStream#skip()
java.io.InputStream#read()
java.util.AbstractList#indexOf()
</code></pre><h2 id="访问者模式"><a class="anchor" href="#访问者模式">#</a> 访问者模式</h2><p>提供一个方便的可维护的方式来操作一组对象。它使得你在不改变操作的对象前提下，可以修改或者扩展对象的行为。</p><pre><code>javax.lang.model.element.Element and 
javax.lang.model.element.ElementVisitor
javax.lang.model.type.TypeMirror and 
javax.lang.model.type.TypeVisitor
</code></pre></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-04-10 21:46:06" itemprop="dateModified" datetime="2024-04-10T21:46:06+08:00">2024-04-10</time> </span><span id="java/design-patterns/设计原则与设计模式/" class="item leancloud_visitors" data-flag-title="设计原则与设计模式" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>范特东东东 <i class="ic i-at"><em>@</em></i>水文 & 摄影</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/java/design-patterns/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E4%B8%8E%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计原则与设计模式">http://example.com/java/design-patterns/设计原则与设计模式/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/photography/%E7%B4%AB%E7%AB%B9%E9%99%A2%E5%85%AC%E5%9B%AD/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;pic.imgdb.cn&#x2F;item&#x2F;65e5f89e9f345e8d036fa68a.jpg" title="紫竹院公园"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 摄影</span><h3>紫竹院公园</h3></a></div><div class="item right"><a href="/mind-map/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE%E5%90%88%E9%9B%86/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;pic.imgdb.cn&#x2F;item&#x2F;6554c7d9c458853aefd85660.jpg" title="思维导图合集"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 思维导图</span><h3>思维导图合集</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">1.</span> <span class="toc-text">（软件）设计原则有哪些</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">设计模式简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">设计模式的分类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%8E%E7%89%B9%E7%82%B9"><span class="toc-number">4.1.</span> <span class="toc-text">定义与特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%86%99%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">常见写法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A5%BF%E6%B1%89%E5%BC%8F%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">饿汉式（线程安全）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%87%92%E6%B1%89%E5%BC%8F%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8"><span class="toc-number">4.2.2.</span> <span class="toc-text">懒汉式（线程不安全）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%87%92%E6%B1%89%E5%BC%8F%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="toc-number">4.2.3.</span> <span class="toc-text">懒汉式（线程安全）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80synchronized-%E5%8A%A0%E9%94%81"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">方式一：synchronized 加锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81dcl"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">方式二：双重检查锁（DCL）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%89%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">4.2.3.3.</span> <span class="toc-text">方式三：静态内部类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E5%8D%95%E4%BE%8B"><span class="toc-number">4.2.4.</span> <span class="toc-text">枚举单例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">4.3.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.4.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.</span> <span class="toc-text">简单工厂模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">工厂方法模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.3.</span> <span class="toc-text">抽象工厂模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9-2"><span class="toc-number">5.4.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-number">5.5.</span> <span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">5.6.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">适配器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">6.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">6.2.</span> <span class="toc-text">类适配器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">6.3.</span> <span class="toc-text">对象适配器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">6.4.</span> <span class="toc-text">接口适配器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9-3"><span class="toc-number">6.5.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="toc-number">6.6.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.</span> <span class="toc-text">代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="toc-number">7.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">7.2.</span> <span class="toc-text">静态代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">7.3.</span> <span class="toc-text">动态代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E8%80%85%E5%8C%BA%E5%88%AB"><span class="toc-number">7.4.</span> <span class="toc-text">二者区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9-4"><span class="toc-number">7.5.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="toc-number">7.6.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.</span> <span class="toc-text">装饰器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="toc-number">8.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9-5"><span class="toc-number">8.2.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-5"><span class="toc-number">8.3.</span> <span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%97%E8%A7%A3%E9%87%8A"><span class="toc-number">8.4.</span> <span class="toc-text">通俗解释</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.</span> <span class="toc-text">观察者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-4"><span class="toc-number">9.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9-6"><span class="toc-number">9.2.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-6"><span class="toc-number">9.3.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-number">10.</span> <span class="toc-text">责任链模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-5"><span class="toc-number">10.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9-7"><span class="toc-number">10.2.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-7"><span class="toc-number">10.3.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.</span> <span class="toc-text">策略模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-6"><span class="toc-number">11.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9-8"><span class="toc-number">11.2.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E5%A5%BD%E5%A4%84"><span class="toc-number">11.3.</span> <span class="toc-text">应用场景（好处）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#spring-%E4%B8%AD%E6%B6%89%E5%8F%8A%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.</span> <span class="toc-text">Spring 中涉及的设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%ACioc"><span class="toc-number">12.1.</span> <span class="toc-text">控制反转（IoC）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5di"><span class="toc-number">12.2.</span> <span class="toc-text">依赖注入（DI）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82"><span class="toc-number">12.3.</span> <span class="toc-text">简单工厂</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95"><span class="toc-number">12.4.</span> <span class="toc-text">工厂方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.5.</span> <span class="toc-text">工厂设计模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.6.</span> <span class="toc-text">单例设计模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.7.</span> <span class="toc-text">代理设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8Baop"><span class="toc-number">12.7.1.</span> <span class="toc-text">面向切面编程（AOP）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-aop-%E5%92%8C-aspectj-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">12.7.2.</span> <span class="toc-text">Spring AOP 和 AspectJ 的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.8.</span> <span class="toc-text">模板方法设计模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.9.</span> <span class="toc-text">观察者设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E6%9C%BA%E5%88%B6%E7%9A%84%E4%B8%89%E7%A7%8D%E8%A7%92%E8%89%B2"><span class="toc-number">12.9.1.</span> <span class="toc-text">Spring 事件监听机制的三种角色</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6"><span class="toc-number">12.9.1.1.</span> <span class="toc-text">事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E8%80%85"><span class="toc-number">12.9.1.2.</span> <span class="toc-text">事件监听者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%8F%91%E5%B8%83%E8%80%85%E4%BA%8B%E4%BB%B6%E6%BA%90"><span class="toc-number">12.9.1.3.</span> <span class="toc-text">事件发布者（事件源）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-%E7%9A%84%E4%BA%8B%E4%BB%B6%E6%B5%81%E7%A8%8B%E5%B0%8F%E7%BB%93"><span class="toc-number">12.9.2.</span> <span class="toc-text">Spring 的事件流程小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.10.</span> <span class="toc-text">适配器设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-aop-%E4%B8%AD"><span class="toc-number">12.10.1.</span> <span class="toc-text">Spring AOP 中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-mvc-%E4%B8%AD"><span class="toc-number">12.10.2.</span> <span class="toc-text">Spring MVC 中</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.11.</span> <span class="toc-text">装饰器设计模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">12.12.</span> <span class="toc-text">策略模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.13.</span> <span class="toc-text">责任链设计模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jdk-%E4%B8%AD%E6%B6%89%E5%8F%8A%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.</span> <span class="toc-text">JDK 中涉及的设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.1.</span> <span class="toc-text">桥接模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">13.2.</span> <span class="toc-text">适配器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.3.</span> <span class="toc-text">组合模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">13.4.</span> <span class="toc-text">装饰器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.5.</span> <span class="toc-text">享元模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">13.6.</span> <span class="toc-text">代理模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">13.7.</span> <span class="toc-text">工厂方法模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">13.8.</span> <span class="toc-text">抽象工厂模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.9.</span> <span class="toc-text">建造者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.10.</span> <span class="toc-text">原型模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">13.11.</span> <span class="toc-text">单例模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">13.12.</span> <span class="toc-text">责任链模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.13.</span> <span class="toc-text">命令模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.14.</span> <span class="toc-text">解释器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.15.</span> <span class="toc-text">迭代器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.16.</span> <span class="toc-text">中介者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.17.</span> <span class="toc-text">备忘录模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.18.</span> <span class="toc-text">空对象模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F-2"><span class="toc-number">13.19.</span> <span class="toc-text">观察者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.20.</span> <span class="toc-text">状态模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F-3"><span class="toc-number">13.21.</span> <span class="toc-text">策略模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.22.</span> <span class="toc-text">模板方法模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.23.</span> <span class="toc-text">访问者模式</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/java/design-patterns/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E4%B8%8E%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="设计原则与设计模式">设计原则与设计模式</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="范特东东东" data-src="/images/avatar.jpg"><p class="name" itemprop="name">范特东东东</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">66</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">21</span> <span class="name">分类</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hqeDE1OQ==" title="https:&#x2F;&#x2F;github.com&#x2F;hjx159"><i class="ic i-github"></i></span> <span class="exturl item xiaohongshu" data-url="aHR0cHM6Ly93d3cueGlhb2hvbmdzaHUuY29tL3VzZXIvcHJvZmlsZS81ZTAyYzhhZDAwMDAwMDAwMDEwMDFmM2U=" title="https:&#x2F;&#x2F;www.xiaohongshu.com&#x2F;user&#x2F;profile&#x2F;5e02c8ad0000000001001f3e"><i class="ic i-xiaohongshu2"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjgxMjE0MzI4MEBxcS5jb20=" title="mailto:812143280@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/categories/photography/" rel="section"><i class="ic i-photography"></i>摄影</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于我</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/photography/%E7%B4%AB%E7%AB%B9%E9%99%A2%E5%85%AC%E5%9B%AD/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/mind-map/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE%E5%90%88%E9%9B%86/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-excise/" title="分类于 Java基础-真题">Java基础-真题</a></div><span><a href="/java/java-se/java-excise/%E7%AC%AC03%E7%AB%A0%EF%BC%9A%E9%9A%8F%E5%A0%82%E5%A4%8D%E4%B9%A0%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98%EF%BC%88%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5%EF%BC%89/" title="宋红康_第03章：流程控制语句">宋红康_第03章：流程控制语句</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-excise/" title="分类于 Java基础-真题">Java基础-真题</a></div><span><a href="/java/java-se/java-excise/%E7%AC%AC01%E7%AB%A0%EF%BC%9A%E9%9A%8F%E5%A0%82%E5%A4%8D%E4%B9%A0%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98%EF%BC%88Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0%EF%BC%89/" title="宋红康_第01章：Java语言概述">宋红康_第01章：Java语言概述</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/juc/" title="分类于 JUC">JUC</a></div><span><a href="/java/juc/JUC%E7%AC%94%E8%AE%B0/" title="JUC 笔记">JUC 笔记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-knowledge/" title="分类于 Java基础-知识点">Java基础-知识点</a></div><span><a href="/java/java-se/java-knowledge/%E5%B0%9A%E7%A1%85%E8%B0%B7_%E5%AE%8B%E7%BA%A2%E5%BA%B7_%E7%AC%AC18%E7%AB%A0_JDK8-17%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E4%B8%8B%EF%BC%89/" title="宋红康_第18章_JDK8-17新特性（下）">宋红康_第18章_JDK8-17新特性（下）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-excise/" title="分类于 Java基础-真题">Java基础-真题</a></div><span><a href="/java/java-se/java-excise/%E7%AC%AC08%E7%AB%A0%EF%BC%9A%E9%9A%8F%E5%A0%82%E5%A4%8D%E4%B9%A0%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98%EF%BC%88%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1-%E9%AB%98%E7%BA%A7%EF%BC%89/" title="宋红康_第08章：面向对象-高级">宋红康_第08章：面向对象-高级</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-excise/" title="分类于 Java基础-真题">Java基础-真题</a></div><span><a href="/java/java-se/java-excise/%E7%AC%AC10%E7%AB%A0%EF%BC%9A%E9%9A%8F%E5%A0%82%E5%A4%8D%E4%B9%A0%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98%EF%BC%88%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%89/" title="宋红康_第10章：多线程">宋红康_第10章：多线程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-excise/" title="分类于 Java基础-真题">Java基础-真题</a></div><span><a href="/java/java-se/java-excise/%E7%AC%AC06%E7%AB%A0%EF%BC%9A%E9%9A%8F%E5%A0%82%E5%A4%8D%E4%B9%A0%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98%EF%BC%88%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1-%E5%9F%BA%E7%A1%80%EF%BC%89/" title="宋红康_第06章：面向对象-基础">宋红康_第06章：面向对象-基础</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/" title="分类于 Java基础">Java基础</a> <i class="ic i-angle-right"></i> <a href="/categories/java/java-se/java-knowledge/" title="分类于 Java基础-知识点">Java基础-知识点</a></div><span><a href="/java/java-se/java-knowledge/%E5%B0%9A%E7%A1%85%E8%B0%B7_%E5%AE%8B%E7%BA%A2%E5%BA%B7_%E7%AC%AC13%E7%AB%A0_%E6%B3%9B%E5%9E%8B/" title="宋红康_第13章_泛型(Generic)">宋红康_第13章_泛型(Generic)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/leetcode/" title="分类于 LeetCode">LeetCode</a> <i class="ic i-angle-right"></i> <a href="/categories/leetcode/carl/" title="分类于 代码随想录">代码随想录</a></div><span><a href="/leetcode/carl/%E7%AC%94%E8%AE%B0%E9%9A%8F%E6%83%B3%E5%BD%95/" title="代码随想录-笔记">代码随想录-笔记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/database/" title="分类于 数据库">数据库</a> <i class="ic i-angle-right"></i> <a href="/categories/database/redis/" title="分类于 Redis">Redis</a></div><span><a href="/database/redis/%E5%B0%9A%E7%A1%85%E8%B0%B7-%E5%91%A8%E9%98%B3-Redis7/" title="Redis7-尚硅谷-周阳">Redis7-尚硅谷-周阳</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">范特东东东 @ fantedong</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">2m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">29:46</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"java/design-patterns/设计原则与设计模式/",favicon:{show:"(●´3｀●)欢迎回来",hide:"(〃＞皿＜)你快回来"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->